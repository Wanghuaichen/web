/**
 * Created by admin on 2015/11/17.
 */$(function(){function q(){var a={},c={},B={},C={};a.max="50";a.start="0";c.family=D;c.uid=M;var e={},g=$("#searchType option:selected").text(),f;"\u5c0f\u65f6"==g?(e.scale="hour",f=new Date(l.min)):("\u5929"==g?(e.scale="day",f=new Date(E.min)):"\u6708"==g?(e.scale="month",f=new Date(z.min)):"\u5e74"==g?(e.scale="year",f=new Date(z.min)):"\u4e00\u5206\u949f"==g?(e.scale="minute",f=new Date(F.min)):"\u5341\u5206\u949f"==g&&(e.scale="minute10",f=new Date(G.min)),"all"==g&&(e.scale="all",f=new Date(l.min)),f=new Date(f.getTime()));g=new Date(d);e.start=f.getTime();e.end=g.getTime()+(864E5-1);c.time=e;c.uid=M;C.asc="time";B.sort=C;var e=manvListhist(c,a,B),e=JSON.parse(e),a=[],B=[],C=[],c=[],b=g=f=0,h=0;if("success"==e.errCode&&0!=e.total){var k=e.resultList,m=/^-?\d+(\.\d+)?$/,p;for(p in k)for(var w in k[p]){var x=k[p][w],q=void 0==k[p].day?"":k[p].day,y;for(y in x)if(void 0==x[y].dvalue){var r=void 0==x[y].values?"":x[y].values,t;for(t in r){var A=[],u=[],v=[],J=[],H=void 0==r[t].min?"":Number(r[t].min).toFixed(3),I=void 0==r[t].max?"":Number(r[t].max).toFixed(3),n=void 0==r[t].avg?"":Number(r[t].avg).toFixed(3),e=void 0==r[t].time?"":r[t].time,L=q.substring(0,4)+"/"+q.substring(4,6)+"/"+q.substring(6,8),e=new Date(L+" "+e);1==m.test(n)&&1==m.test(H)&&1==m.test(I)&&(0==h&&(g=I,f=H),h++,b+=Number(n),I>g&&(g=I),H<f&&(f=H),A.push(e.getTime()),A.push(Number(n)),a.push(A),u.push(e.getTime()),u.push(Number(I)),B.push(u),v.push(e.getTime()),v.push(Number(H)),C.push(v),J.push(e.getTime()),J.push(Number(H)),J.push(Number(I)),c.push(J))}}else n=void 0==x[y].dvalue?"":x[y].dvalue,1==m.test(n)&&(e=void 0==x[y].time?"":x[y].time,0==h&&(f=g=n),h++,b+=Number(n),n>g&&(g=n),n<f&&(f=n),A=[],A.push(e),A.push(Number(n)),a.push(A))}}$("#indicatorMax").text(Number(g).toFixed(2)+";");$("#indicatorMin").text(Number(f).toFixed(2)+";");0==h?$("#indicatorAvg").text(b):$("#indicatorAvg").text((b/h).toFixed(2));p=K;w={chart:{renderTo:"historycontainer",type:p},title:{text:D+"("+N+")"},subtitle:{text:""},xAxis:{type:"datetime",crosshair:!0,endOnTick:!0,showLastLabel:!1,labels:{format:"{value:%Y/%m/%d %H:%M:%S}",rotation:25,align:"left"}},yAxis:{title:{text:""}},tooltip:{shared:!0,useHTML:!0,xDateFormat:"%Y/%m/%d %H:%M:%S"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:D+"\u6307\u6807\u503c",zIndex:1,data:a,marker:{fillColor:"white",lineWidth:2,lineColor:Highcharts.getOptions().colors[0]}},{name:"\u8303\u56f4",data:c,type:"arearange",lineWidth:0,linkedTo:":previous",color:Highcharts.getOptions().colors[0],fillOpacity:.2,zIndex:0}]};"column"==p&&(w.series=[],w.series[0]={},w.series[0].name=D,w.series[0].color="#1aadce",w.series[0].data=a);new Highcharts.Chart(w)}function k(a,b,B,C,e,g,f,h,k,l,m,p){$("#startminute").css("display",k);$("#endminute").css("display",l);$("#start10minute").css("display",m);$("#end10minute").css("display",p);$("#starthour").css("display",a);$("#endhour").css("display",b);$("#startday").css("display",B);$("#endday").css("display",C);$("#startmonth").css("display",e);$("#endmonth").css("display",g);$("#startyear").css("display",f);$("#endyear").css("display",h);$("#startminute").val(c);$("#endminute").val(d);$("#start10minute").val(c);$("#end10minute").val(d);$("#starthour").val(c);$("#endhour").val(d);$("#startday").val(c);$("#endday").val(d);$("#startmonth").val(c);$("#endmonth").val(d);$("#startyear").val(c);$("#endyear").val(d)}k("inline","inline","none","none","none","none","none","none","none","none","none","none");$("#realtime").click(function(){var a=D,c=$("#nowcontainer").highcharts();c.series[0].name=a;c.setTitle({text:"\u6307\u6807 "+a});var b={};b.family=a;b.devId=L;b.name=U;var a={},d={};a.max="50";a.start="0";d.sort={asc:"time"};b=datanow(b,a,d);b=JSON.parse(b);if("success"==b.errCode)for(b=b.poluList,a=b.length,d=0;d<a;d++){JSON.stringify(b[d]);var e=void 0==b[d].value?"":b[d].value,g=void 0==b[d].time?"":b[d].time;if(1==/^-?\d+(\.\d+)?$/.test(e)){var f=[];f.push(1E3*g);f.push(e);c.series[0].addPoint(f)}}});$("#history").click(function(){K="line";$("#searchType option[value\x3d'hour']").attr("selected",!0);""!=u?($("#starthour").val(u),$("#endhour").val(u),d=l.min=u):($("#starthour").val(""),$("#endhour").val(""));$("#startday").val("");$("#endday").val("");$("#startmonth").val("");$("#endmonth").val("");$("#startyear").val("");$("#endyear").val("");q()});$("#searchType").change(function(){var a=$("#searchType option:selected").text();"\u5c0f\u65f6"==a?(k("inline","inline","none","none","none","none","none","none","none","none","none","none"),m.start=c,l.start=d,l.min=c):"\u5929"==a?(k("none","none","inline","inline","none","none","none","none","none","none","none","none"),O.start=c,E.start=d,E.min=c):"\u6708"==a?(k("none","none","none","none","inline","inline","none","none","none","none","none","none"),P.start=c,z.start=d,z.min=c):"\u5e74"==a?(k("none","none","none","none","none","none","inline","inline","none","none","none","none"),Q.start=c,v.start=d,v.min=c):"\u4e00\u5206\u949f"==a?(k("none","none","none","none","none","none","none","none","inline","inline","none","none"),R.start=c,F.start=d,F.min=c):"\u5341\u5206\u949f"==a?(k("none","none","none","none","none","none","none","none","none","none","inline","inline"),S.start=c,G.start=d,G.min=c):"all"==a&&(k("inline","inline","none","none","none","none","none","none","none","none","none","none"),m.start=c,l.start=d,l.min=c)});var d,R={elem:"#startminute",istime:!0,isclear:!1,istoday:!1,format:"YYYY/MM/DD hh:mm:ss",issure:!1,start:laydate.now(-2),max:laydate.now(0),choose:function(a){F.min=a;c=F.start=a}},F={elem:"#endminute",istime:!0,isclear:!1,istoday:!1,issure:!1,format:"YYYY/MM/DD hh:mm:ss",start:laydate.now(0),max:laydate.now(0),choose:function(a){d=a}},S={elem:"#start10minute",istime:!1,isclear:!1,istoday:!1,format:"YYYY/MM/DD hh:mm:ss",issure:!1,start:laydate.now(-2),max:laydate.now(0),choose:function(a){G.min=a;c=G.start=a}},G={elem:"#end10minute",istime:!1,isclear:!1,istoday:!1,issure:!1,format:"YYYY/MM/DD hh:mm:ss",start:laydate.now(0),max:laydate.now(0),choose:function(a){d=a}},m={elem:"#starthour",istime:!1,isclear:!1,istoday:!1,format:"YYYY/MM/DD",issure:!1,start:laydate.now(-2),max:laydate.now(0),choose:function(a){l.min=a;c=l.start=a}},c=m.start,l={elem:"#endhour",istime:!1,isclear:!1,istoday:!1,issure:!1,format:"YYYY/MM/DD",start:laydate.now(0),max:laydate.now(0),choose:function(a){d=a}},O={elem:"#startday",istime:!0,isclear:!1,istoday:!1,format:"YYYY/MM/DD",issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(a){E.min=a;c=E.start=a}},E={elem:"#endday",istime:!1,isclear:!1,istoday:!1,issure:!1,format:"YYYY/MM/DD",start:laydate.now(0),max:laydate.now(0),choose:function(a){d=a}},P={elem:"#startmonth",istime:!1,isclear:!1,istoday:!1,format:"YYYY/MM",issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(a){z.min=a;c=z.start=a}},z={elem:"#endmonth",istime:!1,isclear:!1,istoday:!1,issure:!1,format:"YYYY/MM",start:laydate.now(0),max:laydate.now(0),choose:function(a){d=a}},Q={elem:"#startyear",istime:!1,isclear:!1,istoday:!1,format:"YYYY",issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(a){v.min=a;c=v.start=a}},v={elem:"#endyear",istime:!1,isclear:!1,istoday:!1,issure:!1,format:"YYYY",start:laydate.now(0),max:laydate.now(0),choose:function(a){d=a}};$("#startminute").click(function(){laydate(R)});$("#endminute").click(function(){laydate(F)});$("#start10minute").click(function(){laydate(S)});$("#end10minute").click(function(){laydate(G)});$("#starthour").click(function(){laydate(m)});$("#endhour").click(function(){laydate(l)});$("#startday").click(function(){laydate(O)});$("#endday").click(function(){laydate(E)});$("#startmonth").click(function(){laydate(P)});$("#endmonth").click(function(){laydate(z)});$("#startyear").click(function(){laydate(Q)});$("#endyear").click(function(){laydate(v)});$("#searchpng").click(function(){if(null==d||void 0==d)return alert("\u8bf7\u5148\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"),!1;q()});$("#linechart").click(function(){K="line";q()});$("#columnchart").click(function(){K="column";q()});$("#backIndicator").click(function(){window.location.href="manualIndicatorList.html"});var b=getCookie("manualIndicator"),D="",N="",U="",M="",L="",u=null,K="line";if(void 0!=b&&""!=b){var b=JSON.parse(b),D=void 0==b.family?"":b.family,N=void 0==b.unit?"":b.unit,M=void 0==b.id?"":b.id,u=void 0==b.selectedDate?"":b.selectedDate,b=void 0==b.factory?"":b.factory.name,h={};h.devId=L;h=JSON.parse(listdevice(h));if("success"==h.errCode&&0!=h.total){var T={};T.userId=h.deviceList[0].account.uid;h=JSON.parse(listuser(T));"success"==h.errCode&&$("#deviceProvider").text(h.accountList[0].org);$("#factoryName").text(b)}}$("#starthour").val(m.start);$("#endhour").val(l.start);l.min=m.start;d=l.start;q()});