$(function(){function Q(a){if(void 0!=a){var b=void 0==a.faId?k.userId:a.faId;if("root"!=k.type&&k.userId!=b||k.userName==a.username||"root"==a.type)$(".update").css("display","none"),$(".del").css("display","none"),$(".resetpwd").css("display","none")}else{var c=0;$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),b=void 0==a.faId?k.userId:a.faId;if("root"!=k.type&&k.userId!=b||k.userName==a.username||"root"==a.type)c++,$(".update").css("display","none"),$(".del").css("display","none"),$(".resetpwd").css("display","none")});0==c&&($(".update").css("display","inline"),$(".del").css("display","inline"),$(".resetpwd").css("display","inline"))}}function R(a){$("#userTable tbody").empty();$("#userTable tbody").html("");a=listuser(a);a=JSON.parse(a);if("success"==a.errCode){d=a.accountList;a=d.length;for(var b=0;b<a;b++){var c=JSON.stringify(d[b]);O(c,b+1,d[b].userName,void 0==d[b].type?"":z[d[b].type],void 0==d[b].appName?"":d[b].appName,void 0==d[b].org?"":d[b].org,void 0==d[b].realName?"":d[b].realName,void 0==d[b].mobile?"":d[b].mobile,"audited"==d[b].audit?d[b].status:d[b].audited,void 0==d[b].faId?"":d[b].faId)}sorter.init("userTable",2);sorter.size(10);null!=getCookie("backCurrentPage")&&(sorter.transferToPage(Number(getCookie("backCurrentPage"))),delCookie("backCurrentPage"))}}function O(a,b,c,h,g,p,e,d,f,m){var u="detail"+b;"root"!=k.type&&k.userId!=m||k.userName==c||"root"==h?$("#userTable tbody").append("\x3ctr id\x3d'user_"+b+"'\x3e\x3ctd style\x3d'display: none'\x3e"+a+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+b+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+h+"\x3c/td\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3ctd style\x3d'display:none'\x3e"+p+"\x3c/td\x3e\x3ctd style\x3d'display:none'\x3e"+e+"\x3c/td\x3e\x3ctd style\x3d'display:none'\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../user/checkUserDetail.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+u+"'\x3e\u8be6\u60c5\x3c/a\x3e \x3c/td\x3e\x3c/tr\x3e"):$("#userTable tbody").append("\x3ctr id\x3d'user_"+b+"'\x3e\x3ctd style\x3d'display: none'\x3e"+a+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+b+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+h+"\x3c/td\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3ctd style\x3d'display:none'\x3e"+p+"\x3c/td\x3e\x3ctd style\x3d'display:none'\x3e"+e+"\x3c/td\x3e\x3ctd style\x3d'display:none'\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../user/checkUserDetail.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+u+"'\x3e\u8be6\u60c5\x3c/a\x3e \x3ca href\x3d'javascript:void(0)' class\x3d'delUser tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+u,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("userselected",a);setCookie("userCurrentPage",$("#currentpage").text())})}function V(){var a=$("#add-user").dialog("option","title"),b=$("#userName").val().trim(),c=$("#realname").val().trim(),h=$("input[name\x3daccountTypeRadio]:checked").val(),g=$("#mobile").val().trim(),p=$("#email").val().trim(),d=$("#users1 option:selected").text().trim(),f=$("#users2 option:selected").text().trim(),l=$("#users3 option:selected").text().trim(),m=$("#userdetailaddress").val().trim(),u=$("input[name\x3disEnableRadio]:checked").val();if(""==b)return $(".confirmMsg").html("\u7528\u6237\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==c)return $(".confirmMsg").html("\u771f\u5b9e\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(g.match(/^(\d{7,12})$/)){if(""==p)return $(".confirmMsg").html("\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if("\u7701\u4efd"==d||"\u5730\u7ea7\u5e02"==f||"\u5e02\u3001\u533a\u3001\u53bf"==l)return $(".confirmMsg").html("\u8bf7\u6b63\u786e\u9009\u62e9\u7528\u6237\u6240\u5728\u5730\uff01"),!1;if(""==m)return $(".confirmMsg").html("\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1}else return $(".confirmMsg").html("\u7535\u8bdd\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u5fc5\u987b\u4e3a7-12\u4f4d\u6570\u5b57"),!1;var q={};q.province=d;q.city=f;q.district=l;q.address=m;var n="";if("\u6dfb\u52a0\u7528\u6237"==a){var I=$("#password").val().trim(),a=$("#confirmpwd").val().trim();if(""==I||""==a)return $(".confirmMsg").html("\u5bc6\u7801\u6216\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(I!=a)return $(".confirmMsg").html("\u5bc6\u7801\u4e0e\u786e\u8ba4\u5bc6\u7801\u4fe1\u606f\u4e0d\u4e00\u81f4\uff01"),!1;var v=a="",w="",a=finduser(b);if("failed"==JSON.parse(a).errCode)return $(".confirmMsg").html("\u7528\u6237\u540d\u5df2\u7ecf\u5b58\u5728\uff01"),!1;"root"==k.type||"superr"==k.type?(a=e.name,v=e.id,w=e.type,n=createuser(b,I,h,w,c,"","cywee",a,v,g,p,q,u)):(a=k.org,v=k.orgId,w=k.kind,void 0!=a&&void 0!=v&&(n=createuser(b,I,h,w,c,"","cywee",a,v,g,p,q,u)));q=JSON.parse(n);if("success"==q.errCode)n={},n.id=q.userId,n.address=m,n.userName=b,n.realName=c,n.kind=w,n.status=u,n.audit="audited",n.type=h,n.org=a,n.city=f,n.orgId=v,n.email=p,n.faId=q.userId,n.province=d,n.district=l,n.zone="cywee",n.mobile=g,p=JSON.stringify(n),d=$("#userTable tbody tr").length+1,O(p,d,b,z[h],"",a,c,g,u,k.userId);else return alert("\u521b\u5efa\u7528\u6237\u5931\u8d25\uff01\u539f\u56e0\uff1a"+q.errCode),!1}else{m={};w="";m.userName=b;m.realName=c;m.email=p;m.mobile=g;m.location=q;m.status=u;var r=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text());if("root"==k.type||"superr"==k.type)a=e.name,v=e.id,m.org=a,m.orgId=v,m.kind=e.type,r.org=a,r.orgId=v,r.kind=e.type;m=JSON.parse(updateuser(r.id,m));if("success"==m.errCode)r.userName=b,r.realName=c,r.email=p,r.mobile=g,r.email=p,r.city=f,r.province=d,r.district=l,$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent().attr("id");$("tr[id\x3d'"+a+"']").children("td").eq(0).text(JSON.stringify(r));$("tr[id\x3d'"+a+"']").children("td").eq(3).text(b);$("tr[id\x3d'"+a+"']").children("td").eq(4).text(z[h]);$("tr[id\x3d'"+a+"']").children("td").eq(6).text(e.name);$("tr[id\x3d'"+a+"']").children("td").eq(7).text(c);$("tr[id\x3d'"+a+"']").children("td").eq(8).text(g);$("tr[id\x3d'"+a+"']").children("td").eq(9).text(u)});else return alert("\u4fee\u6539\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01\u539f\u56e0\uff1a"+m.errCode),!1}}function W(a){a.each(function(){var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),c=a.userName,h=void 0==a.realName?"":a.realName,g=void 0==a.mobile?"":a.mobile,p=void 0==a.email?"":a.email,d=void 0==a.province?"":a.province,e=void 0==a.city?"":a.city,f=void 0==a.district?"":a.district,m=void 0==a.address?"":a.address,a=void 0==a.status?"":a.status;$("#userName").val(c);$("#password").val("");$("#realname").val(h);$("#userType").css("display","none");$("#mobile").val(g);$("#email").val(p);$("#users1 option[value\x3d"+d+"]").attr("selected",!0);change(1,t);$("#users2 option[value\x3d"+e+"]").attr("selected",!0);change(2,t);$("#users3 option[value\x3d"+f+"]").attr("selected",!0);$("#userdetailaddress").val(m);$("input[name\x3disEnableRadio][value\x3d"+a+"]").attr("checked",!0)})}function X(){var a=$("#add-org").dialog("option","title"),b=$("#unitname").val().trim(),c=$("#unittype option:selected").val().trim(),h=$("#s1 option:selected").text().trim(),g=$("#s2 option:selected").text().trim(),p=$("#s3 option:selected").text().trim(),d=$("#detailaddress").val().trim(),f=""==$("#lnt").val().trim()?0:$("#lnt").val().trim(),l=""==$("#lat").val().trim()?0:$("#lat").val().trim(),m=$("#linkman").val().trim(),u=$("#professional option:selected").text().trim(),q=""==$("#stuffs").val().trim()?0:$("#stuffs").val().trim(),n=$("#phone").val().trim();if(""==b)return $(".confirmMsg").html("\u5355\u4f4d\u7ec4\u7ec7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if("\u7701\u4efd"==h||"\u5730\u7ea7\u5e02"==g||"\u5e02\u3001\u533a\u3001\u53bf"==p)return $(".confirmMsg").html("\u8bf7\u6b63\u786e\u9009\u62e9\u5355\u4f4d\u6240\u5728\u5730\uff01"),!1;if(""==d)return $(".confirmMsg").html("\u5355\u4f4d\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==m)return $(".confirmMsg").html("\u5355\u4f4d\u8054\u7cfb\u4eba\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(isNaN(q))return $(".confirmMsg").html("\u4eba\u6570\u8bf7\u8f93\u5165\u6570\u5b57!"),!1;if(!n.match(/^(\d{7,12})$/))return $(".confirmMsg").html("\u7535\u8bdd\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u5fc5\u987b\u4e3a7-12\u4f4d\u6570\u5b57"),!1;var k={};k.province=h;k.city=g;k.district=p;k.address=d;k.lnt=f;k.lat=l;var v={};v.name=m;v.phone=n;if("\u6dfb\u52a0\u7ec4\u7ec7"==a){h=JSON.parse(createorg(b,u,c,k,"9999",q,v,e.id));g=h.errCode;if("success"==g)return g={},g.id=h.id,g.location=k,g.profession=u,g.name=b,g.stuffs=q,g.type=c,g.contact=v,g.isCreate=!0,JSON.stringify(g);alert("\u6dfb\u52a0\u7ec4\u7ec7\u5931\u8d25\uff01\u539f\u56e0\uff1a"+g);return!1}var w=$("#owner").val(),a=JSON.parse(JSON.stringify(e)),r={};if(""!=w&&void 0!=w){var t={},w=JSON.parse(w);t.name=w.userName;t.uid=w.id;r.owner=t;a.owner=t}c!=a.type&&(r.type=c,a.type=c);u!=a.profession&&(r.prof=u,a.profession=u);q!=a.stuffs&&(r.stuffs=q,a.stuffs=q);if(n!=a.contact.phone||m!=a.contact.name)r.contact=v,a.contact=v;if(h!=a.location.province||g!=a.location.city||p!=a.location.district||d!=a.location.address||f!=a.location.lnt||l!=a.location.lat)r.location=k,a.location=k;h=JSON.parse(updateorg(b,a.id,r));if("success"==h.errCode)return e.name!=b&&(a.name=b,a.isCreate=!1),e=a,J(),JSON.stringify(a);alert("\u4fee\u6539\u7ec4\u7ec7\u5931\u8d25\uff01\u539f\u56e0\uff1a"+h.errCode);return!1}function S(a){$("#unittype").empty();"factory"==a?$("\x3coption value\x3d"+l.factory+"\x3e"+l.factory+"\x3c/option\x3e").appendTo($("#unittype")):"deviceProvider"==a?($("\x3coption value\x3d"+l.factory+"\x3e"+l.factory+"\x3c/option\x3e").appendTo($("#unittype")),$("\x3coption value\x3d"+l.deviceProvider+"\x3e"+l.deviceProvider+"\x3c/option\x3e").appendTo($("#unittype"))):"operator"==a&&($("\x3coption value\x3d"+l.factory+"\x3e"+l.factory+"\x3c/option\x3e").appendTo($("#unittype")),$("\x3coption value\x3d"+l.deviceProvider+"\x3e"+l.deviceProvider+"\x3c/option\x3e").appendTo($("#unittype")),$("\x3coption value\x3d"+l.operator+"\x3e"+l.operator+"\x3c/option\x3e").appendTo($("#unittype")),$("\x3coption value\x3d"+l.maintenor+"\x3e"+l.maintenor+"\x3c/option\x3e").appendTo($("#unittype")),$("\x3coption value\x3d"+l.appuser+"\x3e"+l.appuser+"\x3c/option\x3e").appendTo($("#unittype")))}function J(){var a=e.type,b=e.contact,c=e.location,h=void 0==c?"":void 0==c.province?"":c.province,g=void 0==c?"":void 0==c.city?"":c.city,p=void 0==c?"":void 0==c.address?"":c.address,d=void 0==c?"":void 0==c.district?"":c.district,f=void 0==c?"":void 0==c.lnt?"":c.lnt,c=void 0==c?"":void 0==c.lat?"":c.lat;$("#orgNameInfo").text(e.name);$("#typeInfo").text(void 0==l[a]?"":l[a]);$("#linkInfo").text(void 0==b?"":void 0==b.name?"":b.name);$("#telInfo").text(void 0==b?"":void 0==b.phone?"":b.phone);$("#lntInfo").text(f);$("#latInfo").text(c);$("#addressInfo").text(h+g+d+p);$("#s1 option[value\x3d"+h+"]").attr("selected",!0);change(1,x);$("#s2 option[value\x3d"+g+"]").attr("selected",!0);change(2,x);$("#s3 option[value\x3d"+d+"]").attr("selected",!0);$("#detailaddress").val(p);$("#lnt").val(f);$("#lat").val(c)}function P(a,b){var c=JSON.parse(listorg(b));if("success"==c.errCode&&0!=c.total){"orgMenu"==a&&$("\x3cul class\x3d'child'\x3e\x3c/ul\x3e").appendTo($("#"+a));var h=c.orgList;f.operator=[];f.deviceProvider=[];f.envProtectAgency=[];f.factory=[];f.other=[];for(var g in h){var d=JSON.stringify(h[g]),c=h[g].type;"operator"==c?f.operator.push(d):"envProtectAgency"==c?f.envProtectAgency.push(d):"factory"==c?f.factory.push(d):"deviceProvider"==c?f.deviceProvider.push(d):f.other.push(d)}for(var k in f)for(var l in f[k]){d=f[k][l];g=JSON.parse(d);var h=g.id,c=g.type,t=g.name,d="\x3cli id\x3d'"+h+"' value\x3d'"+d+"'\x3e\x3ca href\x3d'#' class\x3d'treeMenu'\x3e";"operator"==c?d+="\x3cimg src\x3d'../images/yunyingshang.min.png'\x3e":"envProtectAgency"==c?d+="\x3cimg src\x3d'../images/huanbaoju.min.png'\x3e":"deviceProvider"==c?d+="\x3cimg src\x3d'../images/deviceprovider.min.png'\x3e":"factory"==c&&(d+="\x3cimg src\x3d'../images/factory.min.png'\x3e");d+=t+"\x3c/a\x3e\x3c/li\x3e";$(d).appendTo($("#"+a+" ul:first"));$(document).on("click","#"+h+" a:first",function(){var a=$(this).parent().attr("value");e=JSON.parse(a);J();var b={},a={};b.orgId=e.id;R(b);a.all="";a.scope="other";a.orgId=e.id;0==$(this).parent().find("ul li").length&&(b=$(this).parent().attr("id"),P(b,a))});"branch"==g.bflag&&$("\x3cul class\x3d'child'\x3e\x3c/ul\x3e").appendTo($("#"+h));F(h,"orgMenu")}"orgMenu"==a&&(F("orgMenu","orgMenu"),$("#"+a+" a:first").click());"me"==b.scope&&$("#"+a+" ul li a:first").click()}}function F(a,b){$("#"+a).not(":has(ul)").children("a").css({textDecoration:"none",background:"none"}).click(function(){$("."+b+" li").removeClass("active");$(this).parent("li").addClass("active")});0!=$("#"+a).find("ul").length&&$("#"+a).children("a:first").css({background:"url(../images/list.gif) no-repeat left center"}).click(function(a){$("."+b+" li").removeClass("active");$(this).parent("li").addClass("active");$(this).next("ul").is(":hidden")?($(this).next("ul").slideDown("slow"),$(this).parent("li").siblings("li").children("ul").is(":visible")&&($(this).parent("li").siblings("li").find("ul").slideUp("1000"),$(this).parent("li").siblings("li:has(ul)").children("a").css({background:"url(../images/list.gif) no-repeat left center"}).end().find("li:has(ul)").children("a").css({background:"url(../images/list.gif) no-repeat left center"})),$(this).css({background:"url(../images/clist.min.png) no-repeat left center"})):($(this).next("ul").slideUp("normal"),$(this).css({background:"url(../images/list.gif) no-repeat left center"}),$(this).next("ul").children("li").find("ul").fadeOut("normal"),$(this).next("ul").find("li:has(ul)").children("a").css({background:"url(../images/list.gif) no-repeat left center"}))})}function K(){if(null==e)return $("#tip .tipright p").text("\u5f53\u524d\u6ca1\u6709\u9009\u4e2d\u4efb\u4f55\u7ec4\u7ec7\u4fe1\u606f\uff01"),A.dialog("open"),!1}function T(a,b){var c=JSON.parse(listorg(b));if("success"==c.errCode&&0!=c.total){"accessMenu"==a&&$("\x3cul class\x3d'child'\x3e\x3c/ul\x3e").appendTo($("#"+a));var h=c.orgList;f.operator=[];f.deviceProvider=[];f.envProtectAgency=[];f.factory=[];f.other=[];for(var d in h){var e=JSON.stringify(h[d]),c=h[d].type;"operator"==c?f.operator.push(e):"envProtectAgency"==c?f.envProtectAgency.push(e):"factory"==c?f.factory.push(e):"deviceProvider"==c?f.deviceProvider.push(e):f.other.push(e)}for(var k in f)for(var l in f[k]){e=f[k][l];d=JSON.parse(e);var h=d.id+Math.floor(100*Math.random()+1),c=d.type,t=d.name,m="\x3cinput type\x3d'checkbox' name\x3d'accessCheckbox'/\x3e";void 0!=E[d.id]&&(m="\x3cinput type\x3d'checkbox' name\x3d'accessCheckbox' checked/\x3e",d.allocation=!0,e=JSON.stringify(d));$("#accessCheckAll").is(":checked")&&(m="\x3cinput type\x3d'checkbox' name\x3d'accessCheckbox' checked/\x3e");e="\x3cli id\x3d'"+h+"' value\x3d'"+e+"'\x3e"+m+"\x3ca href\x3d'#' class\x3d'treeMenu'\x3e";"operator"==c?e+="\x3cimg src\x3d'../images/yunyingshang.min.png'\x3e":"envProtectAgency"==c?e+="\x3cimg src\x3d'../images/huanbaoju.min.png'\x3e":"deviceProvider"==c?e+="\x3cimg src\x3d'../images/deviceprovider.min.png'\x3e":"factory"==c&&(e+="\x3cimg src\x3d'../images/factory.min.png'\x3e");e+=t+"\x3c/a\x3e\x3c/li\x3e";$(e).appendTo($("#"+a+" ul:first"));$(document).on("click","#"+h+" a:first",function(){var a=JSON.parse($(this).parent().attr("value")),b={all:"",scope:"other"};b.orgId=a.id;0==$(this).parent().find("ul li").length&&(a=$(this).parent().attr("id"),T(a,b))});"branch"==d.bflag&&$("\x3cul class\x3d'child'\x3e\x3c/ul\x3e").appendTo($("#"+h));F(h,"accessMenu")}"accessMenu"==a&&0==U&&(F("accessMenu","accessMenu"),U++);"me"==b.scope&&($("#"+a+" a:first").click(),$("#"+a+" ul li a:first").click())}}function Y(){E={};var a="";$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){"checkAll"!=$(this).attr("id")&&(a=$(this).parent().parent().children("td").eq(0).text())});if(""!=a&&void 0!=a){var b=JSON.parse(a),b=JSON.parse(resaccessList(b.id));if("success"==b.errCode){var b=b.resultList,c;for(c in b){var d=b[c];E[d.org.id]=JSON.stringify(d)}}}}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});$("#accessCheckAll").click(function(){$(this).is(":checked")?$("input[name\x3d'accessCheckbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'accessCheckbox']").each(function(){$(this).prop("checked",!1)})});var B,A,y,C,L,k=JSON.parse(getCookie("userInfo")).account,M,z={},l={},G={},N=0,H=$(".validateTips"),d=null,e=null,U=0,E,f={};z.root="root";z.superr="\u8d85\u7ea7\u7ba1\u7406\u5458";z.admin="\u7ba1\u7406\u5458";z.common="\u666e\u901a\u7528\u6237";G.hasSubAccount="\u8be5\u8d26\u6237\u4e0b\u8fd8\u6709\u5b50\u8d26\u6237\uff0c\u8bf7\u5148\u5220\u9664\u5b50\u8d26\u6237\u4fe1\u606f\uff01";B=$("#add-user").dialog({autoOpen:!1,height:540,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=V()&&B.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){B.dialog("close")},"class":"cancel"}],close:function(){J();$(".confirmMsg").html("")}});M=$("#resetpwd").dialog({autoOpen:!1,height:340,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){var a;a=$("#resetpassword").val().trim();var b=$("#resetconfirmpwd").val().trim();""==a||""==b?($(".resetconfirmMsg").html("\u5bc6\u7801\u6216\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01"),a=!1):a!=b?($(".resetconfirmMsg").html("\u5bc6\u7801\u4e0e\u786e\u8ba4\u5bc6\u7801\u4fe1\u606f\u4e0d\u4e00\u81f4\uff01"),a=!1):(b={},b.password=a,a=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),a=JSON.parse(updateuser(a.id,b)),"success"==a.errCode?alert("\u4fee\u6539\u5bc6\u7801\u6210\u529f\uff01"):alert("\u4fee\u6539\u5bc6\u7801\u5931\u8d25\uff01\u539f\u56e0\uff1a"+a.errCode),a=void 0);0!=a&&M.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){M.dialog("close")},"class":"cancel"}]});A=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){A.dialog("close")},"class":"sure"}]});y=$("#deltip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){a=$(this).dialog("option","_button");y.dialog("close");var b;if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text());b=JSON.parse(deleteuser(a.id));"success"==b.errCode?$(this).parent().parent().remove():alert("\u5220\u9664\u7528\u6237\u5931\u8d25\uff01\u539f\u56e0\uff1a"+(void 0==G[b.errCode]?b.errCode:G[b.errCode])+"!")});else if("delOrg"==a)a=JSON.parse(deleteorg(e.id)),"success"==a.errCode?$("#"+e.id).remove():alert("\u5220\u9664\u7ec4\u7ec7:"+e.name+" \u5931\u8d25\uff01\u539f\u56e0\uff1a"+a.errCode+"!");else{var c=JSON.parse(a.parent().parent().children("td").eq(0).text());b=JSON.parse(deleteuser(c.id));"success"==b.errCode?a.parent().parent().remove():alert("\u5220\u9664\u7528\u6237\u5931\u8d25\uff01\u539f\u56e0\uff1a"+(void 0==G[b.errCode]?b.errCode:G[b.errCode])+"!")}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){y.dialog("close")},"class":"cancel"}]});C=$("#add-org").dialog({autoOpen:!1,height:450,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){var a=X();if(0!=a)if(C.dialog("close"),a=JSON.parse(a),a.isCreate){0==$("#"+e.id+" ul").length&&(e.bflag="branch",$("#"+e.id).attr("value",JSON.stringify(e)),$("\x3cul class\x3d'child'\x3e\x3c/ul\x3e").appendTo($("#"+e.id)),$("#"+e.id).children("a:first").css({background:"url(../images/list.gif) no-repeat left center"}),F(e.id,"orgMenu"));var b={all:"",scope:"me"};b.orgId=a.id;P(e.id,b)}else{var b=a.type,c="",c="operator"==b?c+"\x3cimg src\x3d'../images/yunyingshang.min.png'\x3e":"envProtectAgency"==b?c+"\x3cimg src\x3d'../images/huanbaoju.min.png'\x3e":"deviceProvider"==b?c+"\x3cimg src\x3d'../images/deviceprovider.min.png'\x3e":c+"\x3cimg src\x3d'../images/factory.min.png'\x3e";$("#"+a.id+" img:first").remove();$("#"+a.id+" a:first").text(a.name);$("#"+a.id+" a:first").prepend(c);$("#"+a.id).attr("value",JSON.stringify(a))}},"class":"sure",id:"addorg"},{text:"\u53d6\u6d88",click:function(){C.dialog("close")},"class":"cancel"}],close:function(){J();$("#unitname").val("");$("#unittype option:first").attr("selected",!0);$("#linkman").val("");$("#professional option:first").attr("selected",!0);$("#stuffs").val("");$("#phone").val("");$(".confirmMsg").html("")}});L=$("#accessDialog").dialog({autoOpen:!1,height:450,width:530,modal:!0,buttons:[{text:"\u5e94\u7528",click:function(){var a=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text());$("input[name\x3d'accessCheckbox']").each(function(){var b=JSON.parse($(this).parent().attr("value")),c=[];if($(this).is(":checked")&&void 0==b.allocation){var d={},e={},f={};d.uid=a.id;d.name=a.userName;e.user=d;f.uId=b.id;f.name=b.name;e.org=f;e.mgroups="all";c.push(e);c=JSON.parse(resaccessCreate(c));"success"!=c.errCode&&($(this).removeAttr("checked"),alert("\u6388\u6743\uff1a"+b.name+"\u5931\u8d25\uff01\u539f\u56e0\uff1a"+c.errCode))}else $(this).is(":checked")||void 0==b.allocation||(c=JSON.parse(E[b.id]),c=JSON.parse(resaccessDelete(c.id)),"success"!=c.errCode&&($(this).attr("checked",!0),alert("\u53d6\u6d88\u6388\u6743\uff1a"+b.name+"\u5931\u8d25\uff01\u539f\u56e0\uff1a"+c.errCode)))});L.dialog("close")},"class":"sure",id:"addorg"},{text:"\u53d6\u6d88",click:function(){L.dialog("close")},"class":"cancel"}],close:function(){$("#accessMenu").find("ul").remove()}});$(".add").click(function(){if(0!=K()){$(".confirmMsg").html("");$("#passwordli").css("display","block");$("#confirmpwdli").css("display","block");$("#userName").attr("readonly",!1);$("#userName").val("");$("#realname").val("");$("#passwordli").val("");$("#confirmpwdli").val("");$("#mobile").val("");$("#email").val("");var a=e.location.city,b=e.location.district,c=e.location.address;$("#users1 option[value\x3d"+e.location.province+"]").attr("selected",!0);change(1,t);$("#users2 option[value\x3d"+a+"]").attr("selected",!0);change(2,t);$("#users3 option[value\x3d"+b+"]").attr("selected",!0);$("#userdetailaddress").val(c);$("input[name\x3disEnableRadio][value\x3d'active']").attr("checked",!0);B.dialog("open");B.dialog({title:"\u6dfb\u52a0\u7528\u6237"});H.text("\u6dfb\u52a0\u7528\u6237\u4fe1\u606f")}});$(".resetpwd").click(function(){$(".resetconfirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),a.id!=k.userId?(a=resetuserpassword(a.id),"success"==JSON.parse(a).errCode?alert("\u91cd\u7f6e\u5bc6\u7801\u6210\u529f\uff01"):alert("\u91cd\u7f6e\u5bc6\u7801\u5931\u8d25\uff01")):M.dialog("open")):($("#tip .tipright p").text("\u5f53\u524d\u4ec5\u4e14\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\uff01"),A.dialog("open"))});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?($("#passwordli").css("display","none"),$("#confirmpwdli").css("display","none"),a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),W(a),$("#userName").attr("readonly",!0),B.dialog("open"),B.dialog({title:"\u4fee\u6539\u7528\u6237"}),H.text("\u4fee\u6539\u7528\u6237\u4fe1\u606f")):($("#tip .tipright p").text("\u5f53\u524d\u4ec5\u4e14\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\uff01"),A.dialog("open"))});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?($("#tip .tipright p").text("\u5f53\u524d\u6ca1\u6709\u9009\u62e9\u4efb\u4f55\u7528\u6237\u4fe1\u606f\uff01"),A.dialog("open")):(y.dialog("option","_button","del"),y.dialog("open"))});$(document).on("click",".delUser",function(){y.dialog("option","_button",$(this));y.dialog("open")});$(".addOrg").click(function(){0!=K()&&($("#ownerLi").css("display","none"),S(e.type),C.dialog({title:"\u6dfb\u52a0\u7ec4\u7ec7"}),H.text("\u6dfb\u52a0\u7ec4\u7ec7\u4fe1\u606f"),C.dialog("open"))});$(document).on("click","input[name\x3d'checkbox']",function(){var a=$(this).attr("id");$(this).is(":checked")&&"checkAll"!=a?(a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),N++,Q(a)):0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?(N=0,$(".update").css("display","inline"),$(".del").css("display","inline"),$(".resetpwd").css("display","inline")):(0<N&&N--,Q())});$(".updateOrg").click(function(){if(0!=K()){$("#ownerLi").css("display","block");var a=e.contact,b=void 0==e.owner?"":e.owner.name;$("#unitname").val(e.name);S(e.type);$("#unittype option[value\x3d"+e.type+"]").attr("selected",!0);$("#linkman").val(void 0==a?"":void 0==a.name?"":a.name);$("#professional option["+e.profession+"]").attr("selected",!0);$("#stuffs").val(e.stuffs);$("#phone").val(void 0==a?"":void 0==a.phone?"":a.phone);$("#owner").empty();a={};a.orgId=e.id;a=JSON.parse(listuser(a));if("success"==a.errCode){d=a.accountList;for(var a=d.length,c=0;c<a;c++){var h=JSON.stringify(d[c]),g=d[c].userName;b==g?$("\x3coption value\x3d'"+h+"' selected\x3e"+g+"\x3c/option\x3e").appendTo($("#owner")):$("\x3coption value\x3d'"+h+"'\x3e"+g+"\x3c/option\x3e").appendTo($("#owner"))}}C.dialog({title:"\u4fee\u6539\u7ec4\u7ec7"});H.text("\u4fee\u6539\u7ec4\u7ec7\u4fe1\u606f");C.dialog("open")}});$(".delOrg").click(function(){0!=K()&&(0!=$("#userTable tbody tr").length?alert("\u5f53\u524d\u7ec4\u7ec7\u4e0b\u6709\u7528\u6237\u4fe1\u606f\uff0c\u4e0d\u80fd\u5220\u9664\uff01"):(y.dialog("option","_button","delOrg"),y.dialog("open")))});$(".access").click(function(){var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=$("input:checkbox[id\x3dcheckAll]:checked").length&&a--;if(0!=a&&1==a){Y();L.dialog("open");var a=0,b="",c;for(c in E){var d=JSON.parse(E[c]),b=b+(d.org.name+"\u3001");a++}H.html("\x3ch2\x3e\u5f53\u524d\u7528\u6237\u6388\u6743\u4e2a\u6570\u662f\uff1a"+a+";\x3c/h2\x3e\x3ch2\x3e\u5206\u522b\u662f\uff1a"+b+"\x3c/h2\x3e\x3cbr/\x3e");T("accessMenu",{all:"",scope:"me"})}else $("#tip .tipright p").text("\u5f53\u524d\u4ec5\u4e14\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\uff01"),A.dialog("open")});$("#searchType").change(function(){var a=$("#searchType option:selected").val();"all"==a?($("#searchByName").css("display","none"),$("#searchByType").css("display","none"),$("#searchByState").css("display","none")):"userName"==a?($("#searchByName").css("display","inline"),$("#searchByType").css("display","none"),$("#searchByState").css("display","none")):"userType"==a?($("#searchByType").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByState").css("display","none")):"userState"==a&&($("#searchByState").css("display","inline"),$("#searchByType").css("display","none"),$("#searchByName").css("display","none"))});$("#searchpng").click(function(){var a={},b=$("#searchType option:selected").val();if("all"==b)a.all="";else if("userName"==b){b=$("#searchByName").val().trim();if(""==b)return alert("\u7528\u6237\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(null!=d){$("#userTable tbody").empty();$("#userTable tbody").html("");for(var a=d.length,c=0,e=0;e<a;e++){var g=JSON.stringify(d[e]),f=d[e].userName,k=void 0==d[e].type?"":z[d[e].type],l=void 0==d[e].org?"":d[e].org,t=void 0==d[e].realName?"":d[e].realName,m=void 0==d[e].mobile?"":d[e].mobile,u="audited"==d[e].audit?d[e].status:d[e].audited,q=void 0==d[e].appName?"":d[e].appName,n=void 0==d[e].faId?"":d[e].faId;if(null==b||(new RegExp(b)).test(f))c++,O(g,c,f,k,q,l,t,m,u,n)}sorter.init("userTable",2);return}a.userName=b}else"userType"==b?(b=$("#searchByType option:selected").val(),a.type=b):"userState"==b&&(b=$("#searchByState option:selected").val(),a.status=b);R(a)});var x=[];x.push("s1");x.push("s2");x.push("s3");setup(x);var t=[];t.push("users1");t.push("users2");t.push("users3");setup(t);var D=[];D.push("search1");D.push("search2");D.push("search3");setup(D);P("orgMenu",{all:"",scope:"me"});(function(){var a=JSON.parse(dictionary("UserKinds")).resultList;$("#unittype").empty();for(var b in a){var c=a[b].UserKinds;for(b in c){var d=c[b];$("\x3coption value\x3d"+d+"\x3e"+d+"\x3c/option\x3e").appendTo($("#unittype"));l[c[b]]=c[b]}}})();"common"==k.type?$(".add").css("display","none"):"admin"==k.type||"superr"==k.type?($(".radio1").css("display","none"),$(".radio2").css("display","none"),$(".radio3").css("display","inline"),$(".radio4").css("display","inline"),$("#radio3").attr("checked",!0)):($(".radio3").css("display","none"),$(".radio4").css("display","none"),$(".radio1").css("display","none"),$(".radio2").css("display","inline"),$("#radio1").attr("checked",!0));$("#search1").change(function(){change(1,D)});$("#search2").change(function(){change(2,D)});$("#search3").change(function(){change(3,D)});$("#s1").change(function(){change(1,x)});$("#s2").change(function(){change(2,x)});$("#s3").change(function(){change(3,x)});$("#users1").change(function(){change(1,t)});$("#users2").change(function(){change(2,t)})});