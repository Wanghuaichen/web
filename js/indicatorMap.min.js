/**
 * Created by admin on 2015/12/25.
 */$(document).ready(function(){function t(){p.clearOverlays();var a=document.getElementById("search1"),c=document.getElementById("search2"),a=a.options[a.selectedIndex].value,c=c.options[c.selectedIndex].value,b={};"\u7701\u4efd"!=a?(b.province=a,p.centerAndZoom(a,6),"\u5730\u7ea7\u5e02"!=c&&(b.city=c)):b=null;a={};null!=b&&(a.location=b);c={};b={};c.max="2000";c.start="0";b.filter={include:"family|devId|factory|lvalue|dvalue|svalue|lower|higher|location|values|uid|name|unit|dmax|id|dmin|max|min"};var g=null;if(null!=u){var g=new Date(u),l={scale:"day"};l.start=g.getTime();l.end=g.getTime()+(864E5-1);a.time=l;a.all="yes";g=JSON.parse(datahistory(a,c,b))}else g=JSON.parse(datanow(a,c,b));if("success"==g.errCode){a=null;q={};if(void 0==g.poluList){var a=g.resultList,n;for(n in a){var c=a[n].dayResult,e;for(e in c){c[e].selectedDate=u;c[e].id=c[e].uid;var b=JSON.stringify(c[e]),d=void 0==c[e].factory.name?"":c[e].factory.name;if(void 0==q[d]||null==q[d])q[d]=[];q[d].push(b)}}}else for(n in a=g.poluList,a){b=JSON.stringify(a[n]);d=void 0==a[n].factory.name?"":a[n].factory.name;if(void 0==q[d]||null==q[d])q[d]=[];q[d].push(b)}for(n in q){var d=n,h=null,k=null,g=b=c=a=null,m=!1,l=q[n];for(e in l){var f=JSON.parse(l[e]);"0"==e&&(h=void 0==f.location.lnt?"":f.location.lnt,k=void 0==f.location.lat?"":f.location.lat,a=void 0==f.location.province?"":f.location.province,c=void 0==f.location.city?"":f.location.city,b=void 0==f.location.district?"":f.location.district,g=void 0==f.location.address?"":f.location.address);var r=void 0==f.lower?"":f.lower;if("yes"==(void 0==f.higher?"":f.higher)||"yes"==r)m=!0}""!=h&&""!=k?y(h,k,d,m,!0):(l=new BMap.LocalSearch(p),l.enableAutoViewport(),l.setSearchCompleteCallback(function(a){a=a.getPoi(0);h=a.point.lng;k=a.point.lat;y(h,k,d,m,!0)}),l.search(a+c+b+g))}}}function y(a,c,b,g,l){var n="",n=l?b:b.name,e=null,d=new BMap.Label(n,{offset:new BMap.Size(20,-10)});d.setStyle({display:"none"});g?(e=new BMap.Icon("../images/redMarker.png",new BMap.Size(25,25)),d.setStyle({color:"red",fontSize:"18px",height:"30px",lineHeight:"30px",border:"red",fontFamily:"\u5fae\u8f6f\u96c5\u9ed1"})):(e=new BMap.Icon("../images/greenMarker.png",new BMap.Size(25,25)),d.setStyle({color:"green",fontSize:"12px",height:"20px",lineHeight:"20px",border:"green",fontFamily:"\u5fae\u8f6f\u96c5\u9ed1"}));a=new BMap.Marker(new BMap.Point(a,c),{icon:e});a.addEventListener("click",function(){var a=x(b,l);this.openInfoWindow(a.infoWindow);this.setZIndex(1E3);setTimeout(function(){sortOp(a.tableId,a.currentPageId,a.pageListId)},10)});a.addEventListener("mouseover",function(){d.setStyle({display:"block"})});a.addEventListener("mouseout",function(){d.setStyle({display:"none"})});a.setLabel(d);p.addOverlay(a)}function x(a,c){var b="",g=Math.floor(1E5*Math.random()),l="manualIndicatorT"+g,n="currentPage"+g,g="pageList"+g;if(c){var e="\x3ctable class\x3d'tablelist sortable' id\x3d'"+l+"'\x3e\x3cthead\x3e\x3ctr\x3e\x3cth class\x3d'nosort' style\x3d'display: none'\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u5e8f\u53f7\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u6307\u6807\u540d\u79f0\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u6307\u6807\u503c\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u8bbe\u5907\u540d\u79f0\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u64cd\u4f5c\x3c/h3\x3e\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e\x3ctbody\x3e",b=a,d=q[a],h;for(h in d){var k=d[h],m=JSON.parse(d[h]),f=parseInt(h)+1,r=m.family,p=m.name,t=m.devId,v="detail"+f,w=null;void 0==m.value?(w=m.values[0],w=void 0==w.avg?w.min:w.avg):w=m.value;m={};m.devId=t;e+="\x3ctr\x3e\x3ctd style\x3d'display: none'\x3e"+k+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e"+r+"/"+p+"\x3c/td\x3e\x3ctd\x3e"+w.toString().substring(0,5)+"\x3c/td\x3e";k=JSON.parse(listdevice(m));e="success"==k.errCode&&1==k.total?e+("\x3ctd\x3e"+k.deviceList[0].name+"\x3c/td\x3e"):e+"\x3ctd\x3e\x3c/td\x3e";e+="\x3ctd\x3e\x3ca href\x3d'indicatorDetail.html' class\x3d'tablelink'target\x3d'rightFrame' onclick\x3d'javascript:detailClick("+v+","+c+");' id\x3d"+v+"\x3e\u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e"}}else if(e="\x3cdiv\x3e\x3ctable class\x3d'tablelist sortable' id\x3d'"+l+"'\x3e\x3cthead\x3e\x3ctr\x3e\x3cth class\x3d'nosort' style\x3d'display: none'\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u5e8f\u53f7\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u6307\u6807\u540d\u79f0\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u6307\u6807\u503c\x3c/h3\x3e\x3c/th\x3e\x3cth\x3e\x3ch3\x3e\u64cd\u4f5c\x3c/h3\x3e\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e\x3ctbody\x3e",b=a.name,v={},f={},d={},k={},r={},f.asc="time",d.max=50,d.start=0,r.name=a.name,r.uId=a.id,k.factory=r,v.sort=f,null!=u?(f={},r=new Date(u),f.scale="day",f.start=r.getTime(),f.end=r.getTime()+(864E5-1),k.time=f,k=JSON.parse(manvListhist(k,d,v))):k=JSON.parse(manvListNow(k,d,v)),"success"==k.errCode)for(h in d=k.poluList,d)f=parseInt(h)+1,v="detail"+f,k=JSON.stringify(d[h]),r=void 0==d[h].family?"":d[h].family,w=void 0==d[h].value?"":d[h].value,e+="\x3ctr\x3e\x3ctd style\x3d'display: none'\x3e"+k+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e"+r+"\x3c/td\x3e\x3ctd\x3e"+w.toString().substring(0,5)+"\x3c/td\x3e",e+="\x3ctd\x3e\x3ca href\x3d'manualIndicatorDetail.html' class\x3d'tablelink'target\x3d'rightFrame' onclick\x3d'javascript:detailClick("+v+","+c+");' id\x3d"+v+"\x3e\u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e";h=new BMap.InfoWindow(e+("\x3c/tbody\x3e\x3c/table\x3e\x3cdiv id\x3d'controls'\x3e\x3cdiv id\x3d'perpage'\x3e\x3cspan\x3e\u6bcf\u9875\u663e\u793a4\u9879\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d'navigation'\x3e\x3cimg src\x3d'../images/first.gif' width\x3d'16' height\x3d'16' alt\x3d'\u9996\u9875' onclick\x3d'javascript:sorter.move(-1,true)' /\x3e\x3cimg src\x3d'../images/previous.gif' width\x3d'16' height\x3d'16' alt\x3d'\u4e0a\u4e00\u9875' onclick\x3d'javascript:sorter.move(-1)' /\x3e\x3cimg src\x3d'../images/next.gif' width\x3d'16' height\x3d'16' alt\x3d'\u4e0b\u4e00\u9875' onclick\x3d'javascript:sorter.move(1)' /\x3e\x3cimg src\x3d'../images/last.gif' width\x3d'16' height\x3d'16' alt\x3d'\u672b\u9875' onclick\x3d'javascript:sorter.move(1,true)' /\x3e\x3c/div\x3e\x3cdiv id\x3d'text'\x3e\u7b2c\x3cspan id\x3d'"+n+"'\x3e\x3c/span\x3e \u9875/\u5171\x3cspan id\x3d'"+g+"'\x3e\x3c/span\x3e\u9875\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"),{width:450,height:280,title:b});b={};b.infoWindow=h;b.tableId=l;b.currentPageId=n;b.pageListId=g;return b}function z(){p.clearOverlays();var a=document.getElementById("search1"),c=document.getElementById("search2"),a=a.options[a.selectedIndex].value,c=c.options[c.selectedIndex].value,b={};"\u7701\u4efd"!=a?(b.province=a,p.centerAndZoom(a,6),"\u5730\u7ea7\u5e02"!=c&&(b.city=c)):b=null;a={};null!=b&&(a.location=b);a.type="factory";a=JSON.parse(listorg(a));if("success"==a.errCode&&0!=a.total){var a=a.orgList,g;for(g in a){var c=a[g],l=!1,b=void 0==c.location?"":c.location,n=""==b?"":void 0==b.lnt?"":b.lnt,b=""==b?"":void 0==b.lat?"":b.lat,e={},d={},h={},k={},m={},f={};e.include="family|devId|factory|lvalue|dvalue|svalue|lower|higher|location|values|uid|name";k.filter=e;d.asc="time";h.max=50;h.start=0;f.name=c.name;f.uId=c.id;m.factory=f;m.hilo="higher|lower";k.sort=d;null!=u?(e={},d=new Date(u),e.scale="day",e.start=d.getTime(),e.end=d.getTime()+(864E5-1),m.time=e,h=JSON.parse(manvListhist(m,h,k))):h=JSON.parse(manvListNow(m,h,k));"success"==h.errCode&&0!=h.total&&(l=!0);y(n,b,c,l,!1)}}}function C(a,c){return{elem:"#startday",istime:c,isclear:!0,istoday:!1,format:a,issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(a){u=a}}}$("#container").css({width:"100%","min-height":"450px",overflow:"hidden",height:$(window).height()-40});0<$(window).height()-435&&$("#container").css({height:$(window).height()-40+"px"});$(window).resize(function(){0<$(window).height()-435&&$("#container").css({height:$(window).height()-40})});(function(){var a={};A=JSON.parse(polusourcedistkey("factory"));if("success"==A.errCode&&0!=A.total){var c=A.resultList,b;for(b in c){var g=c[b].location.province,l=c[b].location.city;void 0==a[g]&&(a[g]=[],a[g].push(l))}c=[];g=0;for(b in a)c.push(b),dsy.add("0_"+g,a[b]),g++;dsy.add("0",c)}})();var B=[];B.push("search1");B.push("search2");setup(B);$("#search1").change(function(){change(1,B);"auto"==$("#showIndicator option:selected").val()?t():z()});$("#search2").change(function(){"auto"==$("#showIndicator option:selected").val()?t():z()});var u=null;$("#startday").click(function(){"auto"==$("#showIndicator option:selected").val()?laydate(C("YYYY/MM/DD",!1)):laydate(C("YYYY/MM/DD hh:mm:ss",!0));$("#laydate_clear").click(function(){u=null});addLaydateListener()});$("#searchpng").click(function(){"auto"==$("#showIndicator option:selected").val()?t():z()});$("#showIndicator").change(function(){"auto"==$("#showIndicator option:selected").val()?t():z()});var p=new BMap.Map("container");p.enableScrollWheelZoom();p.enableContinuousZoom();p.addControl(new BMap.NavigationControl);p.addControl(new BMap.OverviewMapControl);p.centerAndZoom("\u5317\u4eac",6);var q=null;t();var A});function detailClick(t,y){var x=t.getAttribute("id"),x=document.getElementById(x).parentNode.parentNode.firstChild.textContent;y?setCookie("indicatordata",x):setCookie("manualIndicator",x)}function sortOp(t,y,x){sorter.head="head";sorter.asc="asc";sorter.desc="desc";sorter.even="evenrow";sorter.odd="oddrow";sorter.evensel="evenselected";sorter.oddsel="oddselected";sorter.paginate=!0;sorter.currentid=y;sorter.limitid=x;sorter.init(t,1);sorter.size(4)}var sorter=new TINY.table.sorter("sorter");