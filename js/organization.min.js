$(function(){function z(){var a=$("#add-org").dialog("option","title"),b=$("#unitname").val().trim(),f=$("#unittype option:selected").val().trim(),w=$("#s1 option:selected").text().trim(),e=$("#s2 option:selected").text().trim(),c=$("#s3 option:selected").text().trim(),d=$("#detailaddress").val().trim(),t=$("#lnt").val().trim(),q=$("#lat").val().trim(),r=$("#linkman").val().trim(),l=$("#professional option:selected").text().trim(),n=$("#stuffs").val().trim(),p=$("#phone").val().trim();if(""==b)return $(".confirmMsg").html("\u5355\u4f4d\u7ec4\u7ec7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if("\u7701\u4efd"==w||"\u5730\u7ea7\u5e02"==e||"\u5e02\u3001\u533a\u3001\u53bf"==c)return $(".confirmMsg").html("\u8bf7\u6b63\u786e\u9009\u62e9\u5355\u4f4d\u6240\u5728\u5730\uff01"),!1;if(""==d)return $(".confirmMsg").html("\u5355\u4f4d\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==t)return $(".confirmMsg").html("\u7ecf\u5ea6\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==q)return $(".confirmMsg").html("\u7eac\u5ea6\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==r)return $(".confirmMsg").html("\u5355\u4f4d\u8054\u7cfb\u4eba\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(isNaN(n))return $(".confirmMsg").html("\u4eba\u6570\u8bf7\u8f93\u5165\u6570\u5b57!"),!1;if(!p.match(/^(\d{11})$/))return $(".confirmMsg").html("\u624b\u673a\u683c\u5f0f\u4e0d\u6b63\u786e\uff01"),!1;var m={};m.province=w;m.city=e;m.district=c;m.address=d;""!=t&&""!=q&&(m.lnt=t,m.lat=q);var h={};h.name=r;h.phone=p;if("\u6dfb\u52a0\u7ec4\u7ec7"==a){var k=JSON.parse(createorg(b.replace(/\s/g,""),l,f,m,"9999",n,h));if("success"==k.errCode)a={},a.id=k.id,a.name=b,a.type=f,a.profession=l,a.stuffs=n,a.contact=h,a.location=m,l=$(".orgTable tbody tr").length+1,$(".orgTable tbody").append("\x3ctr id\x3d'org_"+l+"'\x3e\x3ctd style\x3d'display: none'\x3e"+JSON.stringify(a)+"\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' type\x3d'checkbox' id\x3d'checkbox_"+l+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+l+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+u[f]+"\x3c/td\x3e\x3ctd\x3e"+w+e+c+d+"\x3c/td\x3e\x3ctd\x3e"+t+"\x3c/td\x3e\x3ctd\x3e"+q+"\x3c/td\x3e\x3ctd\x3e"+r+"\x3c/td\x3e\x3ctd\x3e"+p+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#'  class\x3d'delOrg tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");else return alert("\u6dfb\u52a0\u5931\u8d25\uff01"),!1}else{var g=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),a={};f!=g.type&&(a.type=f,g.type=f);l!=g.profession&&(a.prof=l,g.profession=l);n!=g.stuffs&&(a.stuffs=n,g.stuffs=n);if(p!=g.contact.phone||r!=g.contact.name)a.contact=h,g.contact=h;if(w!=g.location.province||e!=g.location.city||c!=g.location.district||d!=g.location.address||t!=g.location.lnt||q!=g.location.lat)a.location=m,g.location=m;k=JSON.parse(updateorg(b,g.id,a));if("success"==k.errCode)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent();a.children("td").eq(0).text(JSON.stringify(g));a.children("td").eq(3).text(b);a.children("td").eq(4).text(u[f]);a.children("td").eq(5).text(w+e+c+d);a.children("td").eq(6).text(t);a.children("td").eq(7).text(q);a.children("td").eq(8).text(r);a.children("td").eq(9).text(p)});else return alert("\u4fee\u6539\u5931\u8d25\uff01"),!1}}function A(a){a.each(function(){var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),f=a.contact,e=void 0==a.name?"":a.name,u=void 0==a.type?"":a.type,c=void 0==a.profession?"":a.profession,d=void 0==a.location?"":a.location,t=""==d?"":void 0==d.province?"":d.province,q=""==d?"":void 0==d.city?"":d.city,r=""==d?"":void 0==d.district?"":d.district,l=""==d?"":void 0==d.address?"":d.address,n=""==d?"":void 0==d.lnt?"":d.lnt,d=""==d?"":void 0==d.lat?"":d.lat,a=void 0==a.stuffs?"":a.stuffs,p="",m="";void 0!=f&&(p=void 0==f.name?"":f.name,m=void 0==f.phone?"":f.phone);$("#unitname").val(e);$("#detailaddress").val(l);$("#linkman").val(p);$("#stuffs").val(a);$("#phone").val(m);$("#lnt").val(n);$("#lat").val(d);$("#unittype option[value\x3d"+u+"]").attr("selected",!0);$("#professional option[value\x3d"+c+"]").attr("selected",!0);$("#s1 option[value\x3d"+t+"]").attr("selected",!0);change(1,h);$("#s2 option[value\x3d"+q+"]").attr("selected",!0);change(2,h);$("#s3 option[value\x3d"+r+"]").attr("selected",!0);k.dialog("open");k.dialog({title:"\u4fee\u6539\u7ec4\u7ec7"});x.text("\u4fee\u6539\u7ec4\u7ec7\u4fe1\u606f")})}function y(a){$(".orgTable tbody").empty();$(".orgTable tbody").html("");a=listorg(a);a=JSON.parse(a);if("success"==a.errCode){a=a.orgList;for(var b=0;b<a.length;b++){var f=a[b].contact,e=void 0==a[b].name?"":a[b].name,h=void 0==a[b].type?"":a[b].type,c=void 0==a[b].location?"":a[b].location,d=""==c?"":void 0==c.province?"":c.province,k=""==c?"":void 0==c.city?"":c.city,q=""==c?"":void 0==c.district?"":c.district,r=""==c?"":void 0==c.address?"":c.address,l=""==c?"":void 0==c.lnt?"":c.lnt,c=""==c?"":void 0==c.lat?"":c.lat,n="",p="";void 0!=f&&(n=void 0==f.name?"":f.name,p=void 0==f.phone?"":f.phone);$(".orgTable tbody").append("\x3ctr id\x3d'org_"+(b+1)+"'\x3e\x3ctd style\x3d'display: none'\x3e"+JSON.stringify(a[b])+"\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+(b+1)+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+(b+1)+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3ctd\x3e"+u[h]+"\x3c/td\x3e\x3ctd\x3e"+d+k+q+r+"\x3c/td\x3e\x3ctd\x3e"+l+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+n+"\x3c/td\x3e\x3ctd\x3e"+p+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#' class\x3d'delOrg tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e")}sorter.init("orgTable",2)}}var k,e,u={},x=$(".validateTips");u.factory="\u5de5\u5382";u.deviceProvider="\u8bbe\u5907\u5546";u.operator="\u8fd0\u8425\u5546";k=$("#add-org").dialog({autoOpen:!1,height:450,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=z()&&k.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){k.dialog("close")},"class":"cancel"}],close:function(){}});e=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){e.dialog("close");a=$(this).dialog("option","_button");if(null!=a)if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text());deleteorg(a.id);$(this).parent().parent().remove()});else{var b=JSON.parse(a.parent().parent().children("td").eq(0).text());deleteorg(b.id);a.parent().parent().remove()}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){e.dialog("close")},"class":"cancel"}]});$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3dcheckbox][type\x3dcheckbox]").each(function(){$(this).prop("checked",!0)}):$("input[type\x3dcheckbox][name\x3dcheckbox]").each(function(){$(this).prop("checked",!1)})});$(".add").click(function(){$(".confirmMsg").html("");$("#unitname").val("");$("#s1 option:first").prop("selected","selected");$("#s2 option:first").prop("selected","selected");$("#s3 option:first").prop("selected","selected");$("#unittype option:first").prop("selected","selected");$("#professional option:first").prop("selected","selected");$("#detailaddress").val("");$("#lnt").val("");$("#lat").val("");$("#linkman").val("");$("#stuffs").val("");$("#phone").val("");k.dialog("open");k.dialog({title:"\u6dfb\u52a0\u7ec4\u7ec7"});x.text("\u8bf7\u6dfb\u52a0\u4e0b\u9762\u4fe1\u606f")});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),A(a)):(e.dialog("option","title","\u63d0\u793a\u4fe1\u606f"),$("#tip .tipright p").html("\u5f53\u524d\u9700\u8981\u4e14\u53ea\u80fd\u9009\u62e9\u4e00\u6761\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01"),e.dialog("open"))});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?(e.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f"),$("#tip .tipright p").html("\u5f53\u524d\u6ca1\u6709\u9009\u62e9\u4efb\u4f55\u6570\u636e\u8fdb\u884c\u5220\u9664\uff01")):(e.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f"),$("#tip .tipright p").html("\u786e\u5b9a\u5220\u9664\u6570\u636e\u4fe1\u606f\uff01"),e.dialog("option","_button","del"));e.dialog("open")});$(document).on("click",".delOrg",function(){e.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f");$("#tip .tipright p").html("\u786e\u5b9a\u5220\u9664\u6570\u636e\u4fe1\u606f\uff01\uff01");e.dialog("option","_button",$(this));e.dialog("open")});$("#searchType").change(function(){var a=$("#searchType option:selected").text();"\u5168\u90e8"==a?($("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"\u5355\u4f4d\u540d\u79f0"==a?($("#searchByName").css("display","inline"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"\u5355\u4f4d\u5730\u5740"==a?($("#searchByAddress").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByType").css("display","none")):"\u5355\u4f4d\u7c7b\u578b"==a&&($("#searchByType").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"))});$("#searchpng").click(function(){var a={},b=$("#searchType option:selected").text();if("\u5168\u90e8"==b)a.all="";else if("\u5355\u4f4d\u540d\u79f0"==b){b=$("#searchByName").val().trim();if(""==b)return alert("\u7ec4\u7ec7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;a.name=b}else if("\u5355\u4f4d\u5730\u5740"==b){var b=$("#search1 option:selected").text().trim(),f=$("#search2 option:selected").text().trim(),e=$("#search3 option:selected").text().trim();a.location={};if("\u7701\u4efd"==b&&"\u5730\u7ea7\u5e02"==f&&"\u5e02\u3001\u533a\u3001\u53bf"==e)return alert("\u7701\u3001\u5e02\u3001\u533a\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\uff01"),!1;"\u7701\u4efd"!=b&&(a.location.province=b);"\u5730\u7ea7\u5e02"!=f&&(a.location.city=f);"\u5e02\u3001\u533a\u3001\u53bf"!=e&&(a.location.disctrict=e)}else"\u5355\u4f4d\u7c7b\u578b"==b&&(b=$("#searchByType option:selected").text(),a.type=b);y(a)});y({all:""});var h=[];h.push("s1");h.push("s2");h.push("s3");setup(h);var v=[];v.push("search1");v.push("search2");v.push("search3");setup(v);$("#search1").change(function(){change(1,v)});$("#search2").change(function(){change(2,v)});$("#s1").change(function(){change(1,h)});$("#s2").change(function(){change(2,h)})});