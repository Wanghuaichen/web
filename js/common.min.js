/**
 * Created by admin on 2015/10/15.
 */var xmlHttp,url="http://rest.icloud40.com:8081/rest/api/",dataurl="http://rest.icloud40.com:8083/rest/api/",datatypeurl="http://envcloud.icloud40.com:8083/rest/api/",loginpage="../login.html";function createXMLHttpRequest(){try{xmlHttp=new XMLHttpRequest}catch(d){for(var b="Microsoft.XMLHTTP MSXML.XMLHTTP Msxml2.XMLHTTP.7.0 Msxml2.XMLHTTP.6.0 Msxml2.XMLHTTP.5.0 Msxml2.XMLHTTP.4.0 MSXML2.XMLHTTP.3.0 MSXML2.XMLHTTP".split(" "),c=b.length,a=0;a<c;a++){try{xmlHttp=new ActiveXObject(b[a])}catch(e){continue}break}}}var wCRCTalbeAbs=[0,52225,55297,5120,61441,15360,10240,58369,40961,27648,30720,46081,20480,39937,34817,17408];function Gen_Checksum(b,c){var a=65535,d,e;for(d=0;d<c;d++)e=b.charCodeAt(d),a=wCRCTalbeAbs[(e^a)&15]^a>>4,a=wCRCTalbeAbs[(e>>4^a)&15]^a>>4;a=~((a<<3|a>>13)&65535);a=(a&65535).toString(16);0==a.length?a="0000":1==a.length?a="000"+a:2==a.length?a="00"+a:3==a.length&&(a="0"+a);return a.toUpperCase()}function setCookie(b,c){var a=new Date;null!=document.cookie.match(new RegExp("(^| )"+b+"\x3d([^;]*)(;|$)"))&&(a.setTime(a.getTime()-1E3),document.cookie=b+"\x3d;path\x3d/;expires\x3d"+a.toGMTString());a.setTime(a.getTime()+6E6);document.cookie=b+"\x3d"+c+";path\x3d/;expires\x3d"+a.toGMTString()}function getCookie(b){var c;return(c=document.cookie.match(new RegExp("(^| )"+b+"\x3d([^;]*)(;|$)")))?c[2]:null}function delCookie(b){var c=new Date;c.setTime(c.getTime()-1E3);null!=getCookie(b)&&(document.cookie=b+"\x3d;path\x3d/;expires\x3d"+c.toGMTString())}function ajaxcommand(b,c){var a;a=0<=b.indexOf(url)?JSON.parse(getCookie("userInfo")):JSON.parse(getCookie("datauserInfo"));if(null==a)delCookie("userInfo"),alert("\u7528\u6237\u8ba4\u8bc1\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"),window.parent.location.href=loginpage;else{c.operatorId=a.account.userId;c.accessId=a.accessId;c.operType=a.account.type;a=JSON.stringify(c);console.log(b+" param\x3d"+a);try{createXMLHttpRequest();if(!xmlHttp)return'{"errCode":"createXMLHttpRequest"}';xmlHttp.open("POST",b,!1);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlHttp.send("callback\x3d?\x26param\x3d"+a+"\x26"+Math.random)}catch(d){return'{"errCode":"NetworkError"}'}if("authenFailed"==JSON.parse(xmlHttp.responseText).errCode)delCookie("userInfo"),alert("\u670d\u52a1\u7528\u6237\u8ba4\u8bc1\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"),window.parent.location.href=loginpage;else return console.log("response \x3d "+xmlHttp.responseText),xmlHttp.responseText}}function createorgresponse(){JSON.parse(xmlHttp.responseText);alert(xmlHttp.responseText)}function createorg(b,c,a,d,e,f,g,m){var h=url,h=h+"org/create",l={};l.prof=c;l.type=a;l.location=d;l.name=b;l.stuffs=f;l.loc_code=e;l.contact=g;l.faOrgId=m;b=JSON.parse(getCookie("userInfo"));if(null==b)delCookie("userInfo"),alert("\u7528\u6237\u8ba4\u8bc1\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"),window.parent.location.href=loginpage;else return l.creator=b.account.userId,ajaxcommand(h,l)}function updateorg(b,c,a){var d=url,e={};e.name=b;e.orgId=c;for(var f in a)e[f]=a[f];return ajaxcommand(d+"org/update",e)}function deleteorg(b){var c=url,a={};a.orgId=b;return ajaxcommand(c+"org/delete",a)}function listorg(b){var c=url,a={},d;for(d in b)a[d]=b[d];return ajaxcommand(c+"org/list",a)}function login(b,c){var a=url,a=a+"account/login",d={};d.userName=b;d.password=c;d=JSON.stringify(d);try{createXMLHttpRequest();if(!xmlHttp)return'{"errCode":"createXMLHttpRequest"}';xmlHttp.open("POST",a,!1);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlHttp.send("callback\x3dlogin\x26param\x3d"+d)}catch(e){return'{"errCode":"NetworkError"}'}userInfo=JSON.parse(xmlHttp.responseText);"success"==userInfo.errCode&&(accessId=userInfo.accessId,setCookie("userInfo",JSON.stringify(userInfo)),window.location.href="main.html");return xmlHttp.responseText}function logout(){delCookie("userInfo")}function getbizperm(b,c){var a=url,d={};d.userId=b;"all"!=c&&(d.appName=c);return ajaxcommand(a+"perm/getbizperm",d)}function register(b,c,a,d,e,f,g,m){e=url;e+="account/register";var h={};h.userName=b;h.password=c;h.type=a;h.group=d;h.appName="";h.zone="cywee";h.org="";h.location=f;h.realname=realname;h.mobile=g;h.email=m;b=JSON.stringify(h);try{createXMLHttpRequest();if(!xmlHttp)return'{"errCode":"createXMLHttpRequest"}';xmlHttp.open("POST",e,!1);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlHttp.send("callback\x3d?\x26param\x3d"+b)}catch(l){return'{"errCode":"NetworkError"}'}return xmlHttp.responseText}function createuser(b,c,a,d,e,f,g,m,h,l,n,p,q){var r=url,k={};k.userName=b;k.password=c;k.type=a;k.kind=d;k.realName=e;""!=f&&(k.appName=f);k.zone=g;k.org=m;k.orgId=h;k.mobile=l;k.email=n;k.location=p;k.status=q;return ajaxcommand(r+"account/create",k)}function deleteuser(b){var c=url,a={};a.userId=b;return ajaxcommand(c+"account/delete",a)}function listuser(b){var c=url,a={},d;for(d in b)a[d]=b[d];return ajaxcommand(c+"account/list",a)}function updateuser(b,c){var a=url,d={};d.userId=b;for(var e in c)d[e]=c[e];return ajaxcommand(a+"account/update",d)}function resetuserpassword(b){var c=url,a={};a.userId=b;return ajaxcommand(c+"account/resetpwd",a)}function finduser(b){var c=url,a={};a.userName=b;return ajaxcommand(c+"account/nouser",a)}function createuserperm(b,c,a,d){var e=url,f={};f.userId=b;f.appName=c;b={};b.funcList=a;b.permList=d;f.permission=b;return ajaxcommand(e+"perm/create",f)}function listuserperm(b,c){var a=url,d={};"all"==b?d.all="":d.userId=b;"all"!=c&&(d.appName=c);return ajaxcommand(a+"perm/list",d)}function updateuserperm(b,c,a,d){var e=url,e=e+"perm/update",f={},g=JSON.parse(listuserperm(b,c)),m;if("success"==g.errCode){var g=g.permission,h;for(h in g)if(g[h].appName==c){m=g[h].id;break}}else return'{"errCode","No this appName access permission"}';f.id=m;f.userId=b;f.appName=c;b={};b.funcList=a;b.permList=d;f.permission=b;return ajaxcommand(e,f)}function deleteuserperm(b,c){var a=url,a=a+"perm/delete",d={},e=JSON.parse(listuserperm(b,c)),f;if("success"==e.errCode){var e=e.permission,g;for(g in e)if(e[g].appName==c){f=e[g].id;break}}else return'{"errCode":"No this appName access permission"}';d.id=f;return ajaxcommand(a,d)}function createapp(b,c,a,d){var e=url,f={};f.creator=b;f.appName=a;f.scope=c;f.funcPerm=d;return ajaxcommand(e+"app/create",f)}function updateapp(b,c,a){var d=url,e={};e.id=b;e.scope=c;for(var f in a)e[f]=a[f];return ajaxcommand(d+"app/update",e)}function deleteapp(b){var c=url,a={};a.id=b;return ajaxcommand(c+"app/delete",a)}function listapp(b){var c=url,a={},d;for(d in b)a[d]=b[d];return ajaxcommand(c+"app/list",a)}function createdevice(b,c,a){var d=url,e={};e.devId=b;e.name=c;for(var f in a)e[f]=a[f];return ajaxcommand(d+"device/create",e)}function deletedevice(b){var c=url,a={};a.id=b;return ajaxcommand(c+"device/delete",a)}function listdevice(b){var c=url,a={},d;for(d in b)a[d]=b[d];return ajaxcommand(c+"device/list",a)}function listhiststate(b){var c=url,a={},d;for(d in b)a[d]=b[d];return ajaxcommand(c+"device/list/histstate",a)}function listhistreport(b){var c=url,a={},d;for(d in b)a[d]=b[d];return ajaxcommand(c+"device/list/histreport",a)}function updatedevice(b,c){var a=url,d={};d.id=b;for(var e in c)d[e]=c[e];return ajaxcommand(a+"device/update",d)}function updateviews(b,c,a){var d=url,e={};e.id=b;e.action=c;e.views=a;return ajaxcommand(d+"device/updateviews",e)}function findconnstate(b){var c=url,a={};a.id=b;return ajaxcommand(c+"device/list/conn/detail",a)}function datanow(b,c,a){var d=datatypeurl,e={};e.page=c;e.find=b;for(var f in a)e[f]=a[f];return ajaxcommand(d+"polusource/listnow",e)}function polusourcedistkey(b){var c=datatypeurl,a={};a.key=b;return ajaxcommand(c+"polusource/list/now/distkey",a)}function manvdistkey(b){var c=datatypeurl,a={};a.key=b;return ajaxcommand(c+"polumanv/list/now/distkey",a)}function listcities(){var b=dataurl;return ajaxcommand(b+"polusource/listcities",{all:"yes"})}function datahistory(b,c,a,d){var e=datatypeurl,f={};d||(f.page=c,f.find=b);for(var g in a)f[g]=a[g];return ajaxcommand(e+"polusource/listhist",f)}function delPolusource(b){var c=datatypeurl,a={};a.id=b;return ajaxcommand(c+"polusource/delete",a)}function login1(b,c){var a=datatypeurl,a=a+"account/login",d={};d.userName=b;d.password=c;d=JSON.stringify(d);try{createXMLHttpRequest();if(!xmlHttp)return'{"errCode":"createXMLHttpRequest"}';xmlHttp.open("POST",a,!1);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlHttp.send("callback\x3dlogin\x26param\x3d"+d)}catch(e){return'{"errCode":"NetworkError"}'}userInfo=JSON.parse(xmlHttp.responseText);"success"==userInfo.errCode&&(accessId=userInfo.accessId,setCookie("datauserInfo",JSON.stringify(userInfo)));return xmlHttp.responseText}function createdatatype(b,c){var a=datatypeurl,d={};d.name=b;d.poluType=c;return ajaxcommand(a+"polufamily/create",d)}function listdatatype(b){var c=datatypeurl;return ajaxcommand(c+"polufamily/list",b)}function deletedatatype(b){var c=datatypeurl,a={};a.id=b;return ajaxcommand(c+"polufamily/delete",a)}function manvcreate(b){var c=datatypeurl;return ajaxcommand(c+"polumanv/create",b)}function manvListNow(b,c,a){var d=datatypeurl,e={};e.page=c;e.find=b;for(var f in a)e[f]=a[f];return ajaxcommand(d+"polumanv/listnow",e)}function manvUpdate(b){var c=datatypeurl;return ajaxcommand(c+"polumanv/update",b)}function manvListhist(b,c,a,d){var e=datatypeurl,f={};d||(f.page=c,f.find=b);for(var g in a)f[g]=a[g];return ajaxcommand(e+"polumanv/listhist",f)}function manvListdist(b,c,a){var d=datatypeurl,e={};e.page=c;e.find=b;for(var f in a)e[f]=a[f];return ajaxcommand(d+"polumanv/listdist",e)}function manvdelete(b){var c=datatypeurl;return ajaxcommand(c+"polumanv/delete",b)}function uploadfile(b,c,a){var d=datatypeurl,d=d+"polumanv/excel/upload",e;e=0<=d.indexOf(url)?JSON.parse(getCookie("userInfo")):JSON.parse(getCookie("datauserInfo"));if(null==e)delCookie("userInfo"),alert("\u7528\u6237\u8ba4\u8bc1\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"),window.parent.location.href=loginpage;else{var f=new FormData;f.append("operatorId",e.account.userId);f.append("accessId",e.accessId);f.append("type",a);f.append("factory.uId",b.id);f.append("File",c.files[0]);console.log("form "+f);try{createXMLHttpRequest();if(!xmlHttp)return'{"errCode":"createXMLHttpRequest"}';xmlHttp.open("POST",d,!0);ret=xmlHttp.send(f);xmlHttp.onreadystatechange=function(){if(4==xmlHttp.readyState&&200==xmlHttp.status){var a=JSON.parse(xmlHttp.responseText);"authenFailed"==a.errCode?(delCookie("userInfo"),alert("\u7528\u6237\u8ba4\u8bc1\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"),window.parent.location.href=loginpage):("success"==a.errCode?document.getElementById("confirmMsg").innerText="\u5bfc\u5165\u6210\u529f\uff01":document.getElementById("confirmMsg").innerHTML="\u5bfc\u5165\u5931\u8d25\uff0c\u539f\u56e0\uff1a"+a.errCode+",\u9519\u8bef\u4fe1\u606f\uff1a\x3c/br\x3e"+JSON.stringify(a.errInfo)+"\uff01",document.getElementById("progressbar").style.display="none",document.getElementById("fileName").value="",document.getElementById("showFile").value="",console.log("response\x3d"+xmlHttp.responseText))}}}catch(g){return'{"errCode":"NetworkError"}'}}}function devtypeList(b){var c=url;return ajaxcommand(c+"device/devtype/list",b)}function devtypeCreate(b){var c=url;return ajaxcommand(c+"device/devtype/create",b)}function devtypeDelete(b){var c=url;return ajaxcommand(c+"device/devtype/delete",b)}function devtypeUpdate(b){var c=url;return ajaxcommand(c+"device/devtype/update",b)}function upgradeCreate(b,c,a){var d=url,e={};e.dtype=b;e.name=c;e.swInfo=a;return ajaxcommand(d+"swversion/create",e)}function upgradeList(b,c,a){b={};c={};b.name="name";b.dtype="cywee-c801";c.name=a;c.fname="ddd.file";c.version="1.0.0.1";c.url="http://dddff/m.k";c.state="active";b.swInfo=c;a=[];a[0]=b;b={errCode:"success"};b.upgradeList=a;return JSON.stringify(b)}function upgradeDelete(b){var c=url,a={};a.id=b;return ajaxcommand(c+"swversion/delete",a)}function upgradeUpdate(b,c,a,d){var e=url,e=e+"swversion/update",f={};f.id=b;f.dtype=c;f.name=a;c=ajaxcommand(e,f);d&&(c={},c.id=b,c.action="set",c.swInfo=d,c=ajaxcommand(e,c));return c}function resaccessCreate(b){var c=url,a={};a.accessList=b;return ajaxcommand(c+"resaccess/create",a)}function resaccessList(b){var c=url,a={};"all"==b?a.all="":a.userId=b;return ajaxcommand(c+"resaccess/list",a)}function resaccessDelete(b){var c=url,a={};a.id=b;return ajaxcommand(c+"resaccess/delete",a)}function resaccessUpdate(b,c){var a=url,d={};d.id=b;d.accessList=c;return ajaxcommand(a+"resaccess/update",d)}function dictionary(b){var c=url,a={};a.items=b;return ajaxcommand(c+"dictionary/list/enum",a)}function leftmenuclick(){window.parent.frames.leftFrame.document.getElementById("dataAlarmMenuHeader").click();window.parent.frames.leftFrame.document.getElementById("dataManaMenu").click();window.parent.frames.leftFrame.document.getElementById("dataAlarmMenu").click()}function dataFormate(b,c){var a=new Date(b),d=function(a){return(10>a?"0":"")+a};return c.replace(/yyyy|MM|dd|HH|mm|ss/g,function(b){switch(b){case "yyyy":return d(a.getFullYear());case "MM":return d(a.getMonth()+1);case "mm":return d(a.getMinutes());case "dd":return d(a.getDate());case "HH":return d(a.getHours());case "ss":return d(a.getSeconds())}})}function sortOp(b,c,a,d){sorter.head="head";sorter.asc="asc";sorter.desc="desc";sorter.even="evenrow";sorter.odd="oddrow";sorter.evensel="evenselected";sorter.oddsel="oddselected";sorter.paginate=!0;sorter.currentid=c;sorter.limitid=a;sorter.init(b,1);sorter.size(d)}function addLaydateListener(){var b=document.getElementById("laydate_table").getElementsByTagName("td"),c;for(c in b)0<=b[c].className.indexOf("laydate_void")&&b[c].setAttribute("title","\u8be5\u503c\u4e0d\u80fd\u9009\u62e9\uff01")}window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.update();