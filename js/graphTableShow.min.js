$(function(){function q(b){var a={},d={};a.max="2000";a.start="0";var e=null,e={},f=$("#starthour").val();b&&""==f?e=JSON.parse(datanow(e,a,d)):(b=new Date(f),f={scale:"day"},f.start=b.getTime(),f.end=b.getTime()+864E5-1,e.time=f,e.all="yes",e=JSON.parse(datahistory(e,a,d)));if("success"==e.errCode)if(a=null,void 0==e.poluList){var l=a=e.resultList,a={},d={},h;for(h in l){e=l[h].dayResult;b=l[h].day;for(var g in e){var k=e[g];k.day=b;var f=void 0==k.factory.id?"":k.factory.id,m=Number(void 0==k.actMax?"0":k.actMax),c=Number(void 0==k.actMin?"0":k.actMin),n=Number(void 0==k.min?"0":k.min),p=Number(void 0==k.max?"0":k.max),k=JSON.stringify(k);if(m>p||c<n)void 0==d[f]&&(d[f]=[]),d[f].push(k);if(void 0==a[f]||null==a[f])a[f]=[];a[f].push(k)}}r(a,d)}else{h=a=e.poluList;g={};a={};for(l in h){d=JSON.stringify(h[l]);e=h[l];b=void 0==e.factory.id?"":e.factory.id;f=e.higher;if("yes"==e.lower||"yes"==f)void 0==a[b]&&(a[b]=[]),a[b].push(JSON.stringify(d));if(void 0==g[b]||null==g[b])g[b]=[];g[b].push(d)}r(g,a)}}function r(b,a){$("#indicatorTable tbody").empty();$("#indicatorTable tbody").html("");var d=p.length=0,e;for(e in b){var f=b[e],l={},h={},g={};g.orgId=e;for(var k in f){var m=JSON.parse(f[k]),c=m.family,n=m.value;if(void 0==n){var m=m.values,q;for(q in m)n=Number(m[q].avg)}void 0==l[c]&&(l[c]=0,h[c]=0);l[c]++;h[c]+=n}c=JSON.parse(listorg(g));if("success"==c.errCode){var f=c.orgList,r;for(r in f){var t=f[r],g=JSON.stringify(t),n=t.name,u=m="",y;for(y in v)c=v[y],m=void 0==h[c]?m+"\x3ctd\x3e\x3c/td\x3e":m+("\x3ctd\x3e"+(h[c]/l[c]).toFixed(3)+"\x3c/td\x3e");if(void 0!=a[t.id])for(var x in a[t.id])c=JSON.parse(a[t.id][x]),u+="\x3cdiv style\x3d'color: red;font-size: 1px'\x3e"+(void 0==c.day?c.firstT:c.day)+"\u8bbe\u5907\uff1a"+c.devId+"\u4e0a\x3ca href\x3d'#' class\x3d'tablelink'\x3e"+c.family+"\u8d85\u6807\x3c/a\x3e;\x3c/div\x3e";d++;c={};c.str=g;c.factorName=n;c.runState="\u6682\u672a\u5b58";c.dutyOfficer="\u6682\u672a\u5b58";c.indicatorListTd=m;c.alarmInfo=u;p.push(c);w(g,d,n,"\u6682\u672a\u5b58","\u6682\u672a\u5b58",m,u)}}}sorter.init("indicatorTable",1)}function w(b,a,d,e,f,l,h){var g="detail"+a;$("#indicatorTable tbody").append("\x3ctr id\x3d'app_"+a+"'\x3e\x3ctd style\x3d'display: none'\x3e"+b+"\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e"+l+"\x3ctd\x3e"+h+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'siteDetail.html' class\x3d'tablelink'target\x3d'rightFrame' id\x3d'"+g+"'\x3e \u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3c/tr\x3e");$(document).on("click","#"+g,function(){var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),b=$("#starthour").val(),c={};c.name=a.name;c.id=a.id;""!=b&&(a=(new Date(b)).getTime()-864E5,c.startTime=dataFormate(a,"yyyy/MM/dd HH:mm:ss"),c.endTime=b);setCookie("siteDetail",JSON.stringify(c))})}function x(b,a){return{elem:"#starthour",istime:b,isclear:!1,istoday:!1,format:a,issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(a){q()}}}$("#searchType").change(function(){$("#searchByName").val("")});$("#searchpng").click(function(){$("#searchType option:selected").val();var b=$("#searchByName").val();$("#indicatorTable tbody").empty();$("#indicatorTable tbody").html("");for(var a in p){var d=p[a],e=d.str,f=d.factorName,l=d.runState,h=d.dutyOfficer,g=d.indicatorListTd,d=d.alarmInfo;""==b?w(e,++a,f,l,h,g,d):(new RegExp(b)).test(f)&&w(e,++a,f,l,h,g,d)}sorter.init("indicatorTable",1)});$("#starthour").click(function(){$("#enrollmentType option:selected").val();laydate(x(!0,"YYYY/MM/DD hh:mm:ss"));addLaydateListener()});dataFormate((new Date).getTime()-864E5,"yyyy/MM/dd HH:mm:ss");dataFormate((new Date).getTime(),"yyyy/MM/dd HH:mm:ss");var v=[],p=[];(function(){var b=JSON.parse(polusourcedistkey("family"));if("success"==b.errCode&&0!=b.total){var b=b.resultList,a;for(a in b){var d=b[a].family;v.push(d);$("#indicatorTable thead th:eq(5)").after("\x3cth\x3e\x3ch3\x3e"+d+"\x3c/h3\x3e\x3c/th\x3e")}v.reverse()}})();q(!0)});