$(function(){function l(){var a=$("#indicatorselect option:selected").text().trim(),c=$("#factoryList option:selected").val().trim(),e=$("#enrollmentType option:selected").val(),n=[],d={},h={},b={},f={},w;d.max="1";d.start="0";f.asc="time";var k=new Date(t),p={scale:"all"};p.start=(new Date(r)).getTime();p.end=k.getTime();b.time=p;b.hilo="higher|lower";if(null!=c&&"\u5de5\u5382\u5217\u8868"!=c&&"success"==m.errCode&&0!=m.total){var k=m.resultList,g;for(g in k)if(k[g].factory.name==c){w=k[g].factory;break}var q={};q.name=w.name;q.uId=w.id;"All"==a?$("#indicatorselect option").each(function(){var a=this.text;if("All"==a)return!0;var e={},c={};c.time=b.time;c.family=a;c.hilo=b.hilo;c.factory=q;e.find=c;e.page=d;e.sort=f;n.push(e)}):(c={},b.family=a,b.factory=q,c.find=b,c.page=d,c.sort=f,n.push(c))}h.multiFind=n;"auto"==e?(a=datahistory(b,d,h,!0),u(a,!0)):(a=manvListhist(b,d,h,!0),u(a))}function u(a,c){$("#indicatorTable tbody").empty();$("#indicatorTable tbody").html("");var e=JSON.parse(a).multiResult,n=0,d;for(d in e)if("success"==e[d].errCode){var h=e[d].resultList;for(d in h){var b=h[d].dayResult,f;for(f in b){var g=JSON.stringify(b[f]),k=void 0==b[f].dvalue?"":b[f].dvalue,p=void 0==b[f].factory?"":void 0==b[f].factory.name?"":b[f].factory.name,m=void 0==b[f].family?"":b[f].family,q=void 0==b[f].dmax?"":b[f].dmax,r=void 0==b[f].dmin?"":b[f].dmin,l=void 0==b[f].unit?"":b[f].unit,x=void 0==b[f].lower?"":b[f].lower,t=void 0==b[f].time?"":b[f].time,u="",v="",u="yes"==(void 0==b[f].higher?"":b[f].higher)?"\u8d85\u4e0a\u9650":"yes"==x?"\u8d85\u4e0b\u9650":"\u6b63\u5e38",v=c?dataFormate(1E3*t,"yyyy/MM/dd HH:mm:ss"):dataFormate(t,"yyyy/MM/dd HH:mm:ss");n++;y(n,g,m,k,r,q,l,v,p,u,c)}}}0!=n?($("#showNoData").css("display","none"),sorter.init("indicatorTable",2)):$("#showNoData").css("display","block")}function y(a,c,e,n,d,h,b,f,g,k,p){var m="detail"+a;n="\x3ctd\x3e"+n+"\x3c/td\x3e";var q="\x3ctd\x3e"+k+"\x3c/td\x3e",l="\x3ctd\x3e\x3ca href\x3d'indicatorDetail.html' class\x3d'tablelink'target\x3d'rightFrame' id\x3d'"+m+"'\x3e \u67e5\u770b\u8be6\u60c5\x3c/a\x3e";if("\u8d85\u4e0b\u9650"==k||"\u8d85\u4e0a\u9650"==k)q="\x3ctd style\x3d'color: red; font-weight: 800;'\x3e"+k+"\x3c/td\x3e";"\u65e0\u72b6\u6001"==k&&(q="\x3ctd style\x3d'color: #eabc14;font-weight: 800;'\x3e"+k+"\x3c/td\x3e");p||(l="\x3ctd\x3e\x3ca href\x3d'../environmental/manualIndicatorDetail.html' class\x3d'tablelink'target\x3d'rightFrame' id\x3d'"+m+"'\x3e \u67e5\u770b\u8be6\u60c5\x3c/a\x3e");$("#indicatorTable tbody").append("\x3ctr id\x3d'app_"+a+"'\x3e\x3ctd style\x3d'display: none'\x3e"+c+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+a+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e"+n+"\x3ctd\x3e"+d+"-"+h+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e"+q+l+"\x3c/tr\x3e");$(document).on("click","#"+m,function(){var a=$(this).parent().parent().children("td").eq(0).text(),b={};b.startTime=r;b.endTime=t;p?setCookie("indicatordata",a):setCookie("manualIndicator",a);setCookie("alarmInfo",JSON.stringify(b))})}function v(){var a=$("#enrollmentType option:selected").val();$("#indicatorselect").empty();$("\x3coption\x3eAll\x3c/option\x3e").appendTo($("#indicatorselect"));a="auto"==a?JSON.parse(polusourcedistkey("family")):JSON.parse(manvdistkey("family"));if("success"==a.errCode&&0!=a.total){var a=a.resultList,c;for(c in a){var e=a[c].family;$("\x3coption value\x3d"+e+"\x3e"+e+"\x3c/option\x3e").appendTo($("#indicatorselect"))}}}function z(a,c){return{elem:"#starthour",istime:a,isclear:!1,istoday:!1,format:c,issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(e){r=e;$("#timeList").empty();if(!a){e={};var c={},d={};e.max="50";e.start="0";var h=$("#factoryList option:selected").val();if(null!=h&&"\u5de5\u5382\u5217\u8868"!=h){var b=JSON.parse(h),f={},h=new Date(r);f.name=b.name;f.Uid=b.id;c.factory=f;b={scale:"all"};b.start=h.getTime();b.end=h.getTime()+864E5-1;c.time=b;c.distKey="time";e=JSON.parse(manvListdist(c,e,d));if("success"==e.errCode){e=e.resultList;for(var g in e){var c=e[g].dayResult,c=c.sort(function(a,b){return a-b}),k;for(k in c)d=new Date(c[k]),d=(10>d.getHours()?"0"+d.getHours():d.getHours())+":"+(10>d.getMinutes()?"0"+d.getMinutes():d.getMinutes())+":"+(10>d.getSeconds()?"0"+d.getSeconds():d.getSeconds()),$("\x3coption value\x3d"+d+"\x3e"+d+"\x3c/option\x3e").appendTo($("#timeList"))}}}}}}}function A(a){return{elem:"#endhour",istime:!0,isclear:!1,istoday:!1,format:"YYYY/MM/DD hh:mm:ss",issure:!1,start:laydate.now(0),min:a,max:laydate.now(0),choose:function(a){t=a}}}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});$("#enrollmentType").change(function(){v();l()});$("#factoryList").change(function(){l()});$("#searchpng").click(function(){var a=$("#factoryList option:selected").val().trim();null==a&&"\u5de5\u5382\u5217\u8868"==a&&alert("\u5148\u9009\u62e9\u5de5\u5382\u4fe1\u606f\uff01");l()});$("#indicatorselect").change(function(){l()});$("#starthour").click(function(){laydate(z(!0,"YYYY/MM/DD hh:mm:ss"));addLaydateListener()});$("#endhour").click(function(){laydate(A(r));$("#laydate_ms span").click(function(){addLaydateListener()});$("#laydate_ys li").click(function(){addLaydateListener()});addLaydateListener()});var r=dataFormate((new Date).getTime()-864E5,"yyyy/MM/dd HH:mm:ss"),t=dataFormate((new Date).getTime(),"yyyy/MM/dd HH:mm:ss");$("#starthour").val(r);$("#endhour").val(t);(function(){var a={};m=JSON.parse(polusourcedistkey("factory"));if("success"==m.errCode&&0!=m.total){var c=m.resultList,e;for(e in c){var g=void 0==c[e].factory.name?"":c[e].factory.name,d=c[e].location.province,h=c[e].location.city,b=c[e].location.district;void 0==a[d]?(a[d]={},a[d][h]={},a[d][h][b]=[]):void 0==a[d][h]?(a[d][h]={},a[d][h][b]=[]):void 0==a[d][h][b]&&(a[d][h][b]=[]);a[d][h][b].push(g)}c=[];g=0;for(e in a){c.push(e);var d=0,f;for(f in a[e]){var l=[];l.push(f);var h=0,k;for(k in a[e][f]){var p=[];p.push(k);dsy.add("0_"+g+"_"+d+"_"+h,a[e][f][k]);h++}dsy.add("0_"+g+"_"+d,p);d++}dsy.add("0_"+g,l);g++}dsy.add("0",c)}})();v();var g=[];g.push("search1");g.push("search2");g.push("search3");g.push("factoryList");setup(g);1<$("#search1 option").length&&($("#search1 option").eq(1).attr("selected",!0),change(1,g));1<$("#search2 option").length&&($("#search2 option").eq(1).attr("selected",!0),change(2,g));1<$("#search3 option").length&&($("#search3 option").eq(1).attr("selected",!0),change(3,g));1<$("#factoryList option").length&&$("#factoryList option").eq(1).attr("selected",!0);l();var m;$("#search1").change(function(){change(1,g)});$("#search2").change(function(){change(2,g)});$("#search3").change(function(){change(3,g)})});