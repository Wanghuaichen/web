$(function(){function J(){var a=$("#updateManualData li:first input").attr("id"),f;for(f in v){var b=v[f],d;for(d in b)if(a==d){var c=$("#"+a).val().trim(),h={},p=[],g=/^[0-9]+.?[0-9]*$/;if(""!=c&&!g.test(c))return $(".confirmMsg").html(b[d]+"\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;if(""!=c){h.family=b[d];h.unit=b[a+"Unit"];h.value=Number(c);h.vtype="Double";p.push(h);var e=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),h={};h.id=void 0==e.uid?e.id:e.uid;h.time=r.getTime();h.value=Number(c);h.vtype="Double";"success"!=JSON.parse(manvUpdate(h)).errCode?alert("\u4fee\u6539\u5931\u8d25!"):(e.items=p,$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent().attr("id");$("tr[id\x3d'"+a+"']").children("td").eq(0).text(JSON.stringify(e));$("tr[id\x3d'"+a+"']").children("td").eq(3).text(b[d]);$("tr[id\x3d'"+a+"']").children("td").eq(4).text(c)}))}}}}function K(a){$(".orgTable tbody").empty();$(".orgTable tbody").html("");if("success"==a.errCode){e=a.poluList;for(a=0;a<e.length;a++){var f=void 0==e[a].unit?"":e[a].unit,b=void 0==e[a].time?"":e[a].time,d=void 0==e[a].family?"":e[a].family,c=void 0==e[a].value?"":e[a].value,h=void 0==e[a].min?0:e[a].min,p=void 0==e[a].max?0:e[a].max,g="chart"+(a+1);$(".orgTable tbody").append("\x3ctr id\x3d'org_"+(a+1)+"'\x3e\x3ctd style\x3d'display: none'\x3e"+JSON.stringify(e[a])+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+(a+1)+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+(a+1)+"\x3c/td\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+h+"-"+p+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e"+x(1E3*b,"yyyy/MM/dd HH:mm:ss")+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../environmental/manualIndicatorDetail.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+g+"'\x3e \u67e5\u770b\u5386\u53f2\u56fe\x3c/a\x3e\x3ca href\x3d'#' class\x3d'delManual tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+g,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("manualIndicator",a);setCookie("currentPage",1)})}sorter.init("orgTable",2)}}function L(a){a.each(function(){var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),b=a.time,d=a.family,a=void 0==a.value?void 0==a.dvalue?"":a.dvalue:a.value,c;for(c in v){var h=v[c],p;for(p in h)d==h[p]&&M(p,d,a,b)}})}function M(a,f,b,d){$("#updateManualData li:first").html("\x3clabel\x3e"+f+"\x3c/label\x3e\x3cinput type\x3d'text' class\x3d'dfinput' placeholder\x3d'"+f+"' value \x3d '"+b+"'id\x3d'"+a+"'/\x3e");var c=x(d,"yyyy/MM/dd HH:mm:ss");r=new Date(d);$("#recordTime").click(function(){laydate(I("recordTime",!0,c,laydate.now(0),"YYYY/MM/DD hh:mm:ss"))});$("#recordTime").val(c);$("#recordTime").css("display","none")}function I(a,f,b,d,c){return{elem:"#"+a,istime:f,isclear:!1,istoday:!1,format:c,issure:!1,start:b,max:d,choose:function(a){r=new Date(a);$("#timeList").empty();if(!f){$("#timeList").css("display","inline");a={};var b={};a.max="50";a.start="0";b.factory=u;var c={scale:"all"};c.start=r.getTime();c.end=r.getTime()+864E5-1;b.time=c;b.distKey="time";a=JSON.parse(manvListdist(b,a,{}));if("success"==a.errCode){a=a.resultList;for(var d in a){var b=a[d].dayResult,b=b.sort(function(a,b){return a-b}),e;for(e in b)c=new Date(b[e]),c=(10>c.getHours()?"0"+c.getHours():c.getHours())+":"+(10>c.getMinutes()?"0"+c.getMinutes():c.getMinutes())+":"+(10>c.getSeconds()?"0"+c.getSeconds():c.getSeconds()),$("\x3coption value\x3d"+b[e]+"\x3e"+c+"\x3c/option\x3e").appendTo($("#timeList"))}}}}}}var k,r,w,e,l=getCookie("indicatorFactory");w=$("#update-data").dialog({autoOpen:!1,height:280,width:480,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=J()&&w.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){w.dialog("close")},"class":"cancel"}],close:function(){r=null;$("#O2").val("");$("#CO").val("");$("#CO2").val("");$("#NO").val("");$("#NO2").val("");$("#yanwen").val("");$("#NOx").val("");$("#SO2").val("");$("#jingxiaolv").val("");$("#maoxiaolv").val("");$("#bengliuliang").val("");$("#recordTime").val("")}});k=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){k.dialog("close");a=$(this).dialog("option","_button");if(null!=a)if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),b={};b.id=a.id;if(void 0!=a.value)b.which="now";else{b.which="hist";var d={scale:"all"};d.start=a.time;d.end=a.time;b.time=d}"success"==JSON.parse(manvdelete(b)).errCode?$(this).parent().parent().remove():alert("\u5220\u9664\u6307\u6807\u6570\u636e"+a.family+"\u5931\u8d25\uff01")});else{var f=JSON.parse(a.parent().parent().children("td").eq(0).text()),b={};b.id=f.id;if(void 0!=f.value)b.which="now";else{b.which="hist";var d={scale:"all"};d.start=f.time;d.end=f.time;b.time=d}"success"==JSON.parse(manvdelete(b)).errCode?a.parent().parent().remove():alert("\u5220\u9664\u6307\u6807\u6570\u636e"+f.family+"\u5931\u8d25\uff01")}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){k.dialog("close")},"class":"cancel"}]});$("#starthour").click(function(){laydate(I("starthour",!1,laydate.now(0),laydate.now(0),"YYYY/MM/DD"))});$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3dcheckbox][type\x3dcheckbox]").each(function(){$(this).prop("checked",!0)}):$("input[type\x3dcheckbox][name\x3dcheckbox]").each(function(){$(this).prop("checked",!1)})});$(".update").click(function(){k.dialog("option","title","\u4fee\u6539\u63d0\u793a\u4fe1\u606f");if(1!=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length)$("#tip .tipright p").html(" \u8bf7\u9009\u62e9\u4e00\u6761\u4e14\u53ea\u9700\u8981\u9009\u62e9\u4e00\u6761\u6570\u636e\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c\uff01"),k.dialog("open");else{var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked");L(a);w.dialog("open")}});$(".del").click(function(){k.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f");0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?$("#tip .tipright p").html(" \u8bf7\u9009\u62e9\u4e00\u6761\u6216\u591a\u6570\u636e\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\uff01"):($("#tip .tipright p").html("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e9b\u6570\u636e\uff01"),k.dialog("option","_button","del"));k.dialog("open")});$(document).on("click",".delManual",function(){k.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f");$("#tip .tipright p").html("\u786e\u5b9a\u5220\u9664\u6570\u636e\u4fe1\u606f\uff01\uff01");k.dialog("option","_button",$(this));k.dialog("open")});$("#searchpng").click(function(){var a=$("#timeList option:selected").val();if(null==a)alert("\u5f53\u524d\u65f6\u95f4\u6ca1\u6709\u6dfb\u52a0\u6570\u636e\u8bb0\u5f55\uff01");else{$(".orgTable tbody").empty();$(".orgTable tbody").html("");var f={},b={},d={},c={},e={};f.max="50";f.start="0";b.factory=u;c.scale="all";c.start=a;c.end=a;b.time=c;e.asc="time";d.sort=e;c=JSON.parse(manvListhist(b,f,d));if("success"==c.errCode){var a=c.resultList,f=0,k;for(k in a){var b=a[k].dayResult,g;for(g in b){var d=b[g].unit,e=void 0==b[g].family?"":b[g].family,l=void 0==b[g].dvalue?"":b[g].dvalue,n=void 0==b[g].dmin?0:b[g].dmin,q=void 0==b[g].dmax?0:b[g].dmax,c=void 0==b[g].time?"":b[g].time,f=Number(g)+1,m="chart"+f;$(".orgTable tbody").append("\x3ctr id\x3d'org_"+f+"'\x3e\x3ctd style\x3d'display: none'\x3e"+JSON.stringify(b[g])+"\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+f+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3ctd\x3e"+l+"\x3c/td\x3e\x3ctd\x3e"+n+"-"+q+"\x3c/td\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+x(c,"yyyy/MM/dd HH:mm:ss")+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../environmental/manualIndicatorDetail.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+m+"'\x3e \u67e5\u770b\u5386\u53f2\u56fe\x3c/a\x3e\x3ca href\x3d'#' class\x3d'delManual tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+m,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("manualIndicator",a);setCookie("currentPage","1")})}}sorter.init("orgTable",2);r=null}}});var x=function(a,e){var b=new Date(a),d=function(a){return(10>a?"0":"")+a};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,function(a){switch(a){case "yyyy":return d(b.getFullYear());case "MM":return d(b.getMonth()+1);case "mm":return d(b.getMinutes());case "dd":return d(b.getDate());case "HH":return d(b.getHours());case "ss":return d(b.getSeconds())}})},q={},m={},n={},t={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={};q.runTime="\u8fd0\u884c\u65f6\u95f4";m.O2="O2";n.CO="CO";t.CO2="CO2";y.NO="NO";z.NO2="NO2";A.yanwen="\u70df\u6e29";B.NOx="NOx";C.SO2="SO2";D.jingxiaolv="\u51c0\u6548\u7387";E.maoxiaolv="\u6bdb\u6548\u7387";F.huanwen="\u73af\u6e29";G.bengliuliang="\u6cf5\u6d41\u91cf";H.xishibeishu="\u7a00\u91ca\u500d\u6570";q.runTimeUnit="ms";m.O2Unit="%25";n.COUnit="ppm";t.CO2Unit="%25";y.NOUnit="ppm";z.NO2Unit="ppm";A.yanwenUnit="\u2103";B.NOxUnit="ppm";C.SO2Unit="ppm";D.jingxiaolvUnit="%25";E.maoxiaolvUnit="%25";F.huanwenUnit="\u2103";G.bengliuliangUnit="l/min";H.xishibeishuUnit="\u500d";var v=[q,m,n,t,y,z,A,B,C,D,F,E,G,H];if(null!=l){var q={},m={},n={},t={},u={},l=JSON.parse(l);m.asc="time";n.max=50;n.start=0;u.name=l.name;u.uId=l.id;t.factory=u;q.sort=m;l=JSON.parse(manvListNow(t,n,q));K(l)}});