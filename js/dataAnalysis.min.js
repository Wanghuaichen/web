/**
 * Created by admin on 2015/11/17.
 */$(function(){function h(){var b={},x={},d={};b.max="2000";b.start="0";x.family=y;d.sort={asc:"time"};var a={},e=$("#searchType option:selected").val(),f=new Date(r);a.end=(new Date(t)).getTime()+(864E5-1);"hour"==e&&(a.scale="hour",a.end-=864E5-1);"day"==e?a.scale="day":"month"==e?a.scale="month":"year"==e?a.scale="year":"minute"==e?(a.scale="minute",a.end-=864E5-1):"minute10"==e?(a.scale="minute10",a.end-=864E5-1):"all"==e&&(a.scale="all");f=new Date(f.getTime());a.start=f.getTime();x.time=a;var a=datahistory(x,b,d),a=JSON.parse(a),b=[],x=[],d=[],e=[],c=f=0,v=0,w=0;if("success"==a.errCode&&0!=a.total){var h=a.resultList,A=/^-?\d+(\.\d+)?$/,z;for(z in h)for(var J in h[z]){var k=h[z].dayResult,G=void 0==h[z].day?"":h[z].day,l;for(l in k)if(B=k[l].max,C=k[l].min,K=k[l].unit,void 0==k[l].dvalue){var m=void 0==k[l].values?"":k[l].values,n;for(n in m){var u=[],H=[],I=[],D=[],p=void 0==m[n].min?"":Number(m[n].min).toFixed(3),q=void 0==m[n].max?"":Number(m[n].max).toFixed(3),g=void 0==m[n].avg?"":Number(m[n].avg).toFixed(3),a=void 0==m[n].time?"":m[n].time,p=Number(p),q=Number(q),F=G.substring(0,4)+"/"+G.substring(4,6)+"/"+G.substring(6,8),a=new Date(F+" "+a);1==A.test(g)&&1==A.test(p)&&1==A.test(q)&&(0==w&&(c=q,f=p),w++,v+=Number(g),q>c&&(c=q),p<f&&(f=p),u.push(a.getTime()),u.push(Number(g)),b.push(u),H.push(a.getTime()),H.push(Number(q)),x.push(H),I.push(a.getTime()),I.push(Number(p)),d.push(I),D.push(a.getTime()),D.push(Number(p)),D.push(Number(q)),e.push(D))}}else g=void 0==k[l].dvalue?"":Number(k[l].dvalue).toFixed(3),1==A.test(g)&&(a=void 0==k[l].time?"":k[l].time,0==w&&(f=c=g),w++,v+=Number(g),g>c&&(c=g),g<f&&(f=g),u=[],u.push(1E3*a),u.push(Number(g)),b.push(u))}}$("#indicatorMax").text(Number(c).toFixed(2)+";");$("#indicatorMin").text(Number(f).toFixed(2)+";");0==w?$("#indicatorAvg").text(v):$("#indicatorAvg").text((v/w).toFixed(2));b.sort(function(a,b){return a[0]-b[0]});e.sort(function(a,b){return a[0]-b[0]});L(E,b,e)}function L(b,c,d){d={chart:{renderTo:"historycontainer",type:b},title:{useHTML:!0,text:y+"("+K+")\x3cbr\x3e\x3clabel style\x3d'font-size: x-small;color: red'\x3e(\u9608\u503c\uff1a"+C+"-"+B+")\x3c/label\x3e"},subtitle:{text:""},xAxis:{type:"datetime",endOnTick:!0,showLastLabel:!1,labels:{format:"{value:%Y/%m/%d %H:%M:%S}",rotation:25,align:"left"}},yAxis:{title:{text:""},plotLines:[{value:C,width:1,color:"red",zIndex:5,label:{text:"\u4e0b\u9650\u6807\u51c6: "+C,align:"center",style:{color:"red"}}},{value:B,width:1,color:"red",zIndex:5,label:{text:"\u4e0a\u9650\u6807\u51c6: "+B,align:"center",style:{color:"red"}}}]},tooltip:{crosshairs:[!0,!0],shared:!0,useHTML:!0,xDateFormat:"%Y/%m/%d %H:%M:%S"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:y+"\u503c",zIndex:1,data:c,marker:{fillColor:"white",lineWidth:2,lineColor:Highcharts.getOptions().colors[0]}},{name:"\u8303\u56f4",data:d,type:"arearange",lineWidth:0,linkedTo:":previous",color:Highcharts.getOptions().colors[0],fillOpacity:.2,zIndex:0}]};"column"==b&&(d.series=[],d.series[0]={},d.series[0].name=y,d.series[0].color="#1aadce",d.series[0].data=c);new Highcharts.Chart(d)}function J(b,c,d,a){b={elem:"#starthour",istime:b,isclear:!1,istoday:!1,format:a,issure:!1,start:c,max:d,choose:function(a){r=a}};r=b.start;return b}function F(b,c,d,a,e){b={elem:"#endhour",istime:b,isclear:!1,istoday:!1,format:e,issure:!1,start:c,min:d,max:a,choose:function(a){t=a}};t=b.start;return b}function c(b,c,d,a){var e="YYYY/MM/DD",f=!1;if("minute"==b||"minute10"==b||"hour"==b)e="YYYY/MM/DD hh:mm:ss",f=!0;c&&(J(f,laydate.now(-2),laydate.now(0),e),F(f,laydate.now(0),r,laydate.now(0),e));d&&laydate(J(f,r,laydate.now(0),e));a&&laydate(F(f,t,r,laydate.now(0),e));$("#starthour").val(r);$("#endhour").val(t)}c("hour",!0);$("#history").click(function(){E="line";$("#searchType option[value\x3d'hour']").attr("selected",!0);h()});$("#searchType").change(function(){var b=$("#searchType option:selected").val();"minute"==b||"minute10"==b?c("minute"):c("hour")});var t,r;$("#starthour").click(function(){var b=$("#searchType option:selected").val();"minute"==b||"minute10"==b?c("minute",!1,!0):c("hour",!1,!0);addLaydateListener()});$("#endhour").click(function(){var b=$("#searchType option:selected").val();"minute"==b||"minute10"==b?c("minute",!1,!1,!0):c("hour",!1,!1,!0);$("#laydate_ms span").click(function(){addLaydateListener()});$("#laydate_ys li").click(function(){addLaydateListener()});addLaydateListener()});$("#searchpng").click(function(){if(""==t||void 0==t)return alert("\u8bf7\u5148\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"),!1;h()});$("#linechart").click(function(){E="line";h()});$("#columnchart").click(function(){E="column";h()});var y=getCookie("monitorMenu"),E="line",K="",B=0,C=0;$("#currentPageTitle").text(y+"\u51cf\u6392\u5206\u6790");h()});window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.update();