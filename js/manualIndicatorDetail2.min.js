/**
 * Created by admin on 2015/11/17.
 */$(function(){function k(){var b={},c={},C={},h={};b.max="2000";b.start="0";c.family=A;c.uid=F;var a={},e=new Date(l),n=new Date(m),f=$("#searchType option:selected").text();a.end=e.getTime()+(864E5-1);"\u5c0f\u65f6"==f?a.scale="hour":"\u5929"==f?a.scale="day":"\u6708"==f?a.scale="month":"\u5e74"==f?a.scale="year":"\u4e00\u5206\u949f"==f?(a.scale="minute",a.end-=864E5-1):"\u5341\u5206\u949f"==f&&(a.scale="minute10",a.end-=864E5-1);"all"==f&&(a.scale="all");a.start=n.getTime();c.time=a;c.uid=F;h.asc="time";C.sort=h;var a=manvListhist(c,b,C),a=JSON.parse(a),b=[],C=[],h=[],c=[],d=f=n=e=0;if("success"==a.errCode&&0!=a.total){var B=a.resultList,k=/^-?\d+(\.\d+)?$/,r;for(r in B)for(var t in B[r]){var u=B[r][t],w=void 0==B[r].day?"":B[r].day,v;for(v in u)if(void 0==u[v].dvalue){var p=void 0==u[v].values?"":u[v].values,q;for(q in p){var x=[],G=[],H=[],D=[],y=void 0==p[q].min?"":Number(p[q].min).toFixed(3),z=void 0==p[q].max?"":Number(p[q].max).toFixed(3),g=void 0==p[q].avg?"":Number(p[q].avg).toFixed(3),a=void 0==p[q].time?"":p[q].time,E=w.substring(0,4)+"/"+w.substring(4,6)+"/"+w.substring(6,8),a=new Date(E+" "+a);1==k.test(g)&&1==k.test(y)&&1==k.test(z)&&(0==d&&(n=z,e=y),d++,f+=Number(g),z>n&&(n=z),y<e&&(e=y),x.push(a.getTime()),x.push(Number(g)),b.push(x),G.push(a.getTime()),G.push(Number(z)),C.push(G),H.push(a.getTime()),H.push(Number(y)),h.push(H),D.push(a.getTime()),D.push(Number(y)),D.push(Number(z)),c.push(D))}}else g=void 0==u[v].dvalue?"":Number(u[v].dvalue).toFixed(3),1==k.test(g)&&(a=void 0==u[v].time?"":u[v].time,0==d&&(e=n=g),d++,f+=Number(g),g>n&&(n=g),g<e&&(e=g),x=[],x.push(a),x.push(Number(g)),b.push(x))}}$("#indicatorMax").text(Number(n).toFixed(2)+";");$("#indicatorMin").text(Number(e).toFixed(2)+";");0==d?$("#indicatorAvg").text(f):$("#indicatorAvg").text((f/d).toFixed(2));r=I;t={chart:{renderTo:"historycontainer",type:r},title:{text:A+"("+J+")"},subtitle:{text:""},xAxis:{type:"datetime",crosshair:!0,endOnTick:!0,showLastLabel:!1,labels:{format:"{value:%Y/%m/%d %H:%M:%S}",rotation:25,align:"left"}},yAxis:{title:{text:""}},tooltip:{shared:!0,useHTML:!0,xDateFormat:"%Y/%m/%d %H:%M:%S"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:A+"\u503c",zIndex:1,data:b,marker:{fillColor:"white",lineWidth:2,lineColor:Highcharts.getOptions().colors[0]}},{name:"\u8303\u56f4",data:c,type:"arearange",lineWidth:0,linkedTo:":previous",color:Highcharts.getOptions().colors[0],fillOpacity:.2,zIndex:0}]};"column"==r&&(t.series=[],t.series[0]={},t.series[0].name=A,t.series[0].color="#1aadce",t.series[0].data=b);new Highcharts.Chart(t)}function E(b,c,d,h){b={elem:"#starthour",istime:b,isclear:!1,istoday:!1,format:h,issure:!1,start:c,max:d,choose:function(a){m=a}};m=b.start;return b}function K(b,c,d,h,a){b={elem:"#endhour",istime:b,isclear:!1,istoday:!1,format:a,issure:!1,start:c,min:d,max:h,choose:function(a){l=a}};l=b.start;return b}function d(b,c,d,h){var a="YYYY/MM/DD",e=!1;if("minute"==b||"minute10"==b||"hour"==b)a="YYYY/MM/DD hh:mm:ss",e=!0;c&&(E(e,laydate.now(-2),laydate.now(0),a),K(e,laydate.now(0),m,laydate.now(0),a));d&&laydate(E(e,m,laydate.now(0),a));h&&laydate(K(e,l,m,laydate.now(0),a));$("#starthour").val(m);$("#endhour").val(l)}d("hour",!0);$("#searchType").change(function(){var b=$("#searchType option:selected").val();"minute"==b||"minute10"==b?d("minute"):d("hour")});var l,m;$("#starthour").click(function(){var b=$("#searchType option:selected").val();"minute"==b||"minute10"==b?d("minute",!1,!0):d("hour",!1,!0)});$("#endhour").click(function(){var b=$("#searchType option:selected").val();"minute"==b||"minute10"==b?d("minute",!1,!1,!0):d("hour",!1,!1,!0)});$("#searchpng").click(function(){if(null==l||void 0==l)return alert("\u8bf7\u5148\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"),!1;k()});$("#linechart").click(function(){I="line";k()});$("#columnchart").click(function(){I="column";k()});$("#backIndicator").click(function(){window.location.href=null!=L?"manualIndicatorList.html":null!=w?"alarm.html":"indicatorMap.html"});var c=getCookie("manualIndicator"),L=getCookie("currentPage"),w=getCookie("alarmInfo"),A="",J="",F="",I="line";delCookie("currentPage");delCookie("alarmInfo");void 0!=c&&""!=c&&(c=JSON.parse(c),A=void 0==c.family?"":c.family,J=void 0==c.unit?"":c.unit,F=null!=w?void 0==c.uid?"":c.uid:void 0==c.id?"":c.id);null!=w&&(c=JSON.parse(w),m=c.startTime,l=c.endTime,$("#starthour").val(m),$("#endhour").val(l));k()});window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.update();