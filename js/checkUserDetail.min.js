$(function(){function t(a){$("#childUser tbody").empty();$("#childUser tbody").html("");a=listuser(a);a=JSON.parse(a);if("success"==a.errCode){a=a.accountList;for(var d=a.length,b=0;b<d;b++){JSON.stringify(a[b]);var c=a[b].userName,g=a[b].type,e=void 0==a[b].org?"":a[b].org,l=void 0==a[b].realName?"":a[b].realName,f=void 0==a[b].mobile?"":a[b].mobile,h=void 0==a[b].appName?"":a[b].appName,k="audited"==a[b].audit?a[b].status:a[b].audited;$("#childUser tbody").append("\x3ctr id\x3d'user_"+(b+1)+"'\x3e\x3ctd style\x3d'display: none'\x3e"+a[b].id+"\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+(b+1)+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+(b+1)+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+u[g]+"\x3c/td\x3e\x3ctd\x3e"+h+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3ctd\x3e"+l+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e"+k+"\x3c/td\x3e\x3c/tr\x3e")}sorter.init("childUser",2)}}function v(){var a=$("#add-user").dialog("option","title"),d=$("#userName").val().trim(),b=$("#realname").val().trim(),c=$("input[name\x3daccountTypeRadio]:checked").val(),e=$("#childorgList option:selected").val(),f=$("#mobile").val().trim(),l=$("#email").val().trim(),h=$("#users1 option:selected").text().trim(),k=$("#users2 option:selected").text().trim(),m=$("#users3 option:selected").text().trim(),n=$("#userdetailaddress").val().trim(),p=$("input[name\x3disEnableRadio]:checked").val();if(""==d)return $(".confirmMsg").html("\u7528\u6237\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==b)return $(".confirmMsg").html("\u771f\u5b9e\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==f)return $(".confirmMsg").html("\u624b\u673a\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==l)return $(".confirmMsg").html("\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if("\u7701\u4efd"==h||"\u5730\u7ea7\u5e02"==k||"\u5e02\u3001\u533a\u3001\u53bf"==m)return $(".confirmMsg").html("\u8bf7\u6b63\u786e\u9009\u62e9\u7528\u6237\u6240\u5728\u5730\uff01"),!1;if(""==n)return $(".confirmMsg").html("\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;var q={};q.province=h;q.city=k;q.district=m;q.address=n;if("\u6dfb\u52a0\u5b50\u7528\u6237"!=a){a={};a.userName=d;a.realName=b;a.email=l;a.mobile=f;a.location=q;a.status=p;if("root"==g.type||"superr"==g.type){if(""==e||void 0==e)return $(".confirmMsg").html("\u8bf7\u9009\u62e9\u7ec4\u7ec7\u4fe1\u606f\uff01"),!1;l=JSON.parse(e);orgName=l.name;orgId=l.id;a.org=orgName;a.orgId=orgId}l=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text();l=updateuser(l,a);if("success"==JSON.parse(l).errCode)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent().attr("id");$("tr[id\x3d'"+a+"']").children("td").eq(3).text(d);$("tr[id\x3d'"+a+"']").children("td").eq(4).text(u[c]);$("tr[id\x3d'"+a+"']").children("td").eq(6).text(e.name);$("tr[id\x3d'"+a+"']").children("td").eq(7).text(b);$("tr[id\x3d'"+a+"']").children("td").eq(8).text(f);$("tr[id\x3d'"+a+"']").children("td").eq(9).text(p)});else return alert("\u4fee\u6539\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01"),!1}}function w(a){a.each(function(){var a=$(this).parent().parent().children("td").eq(0).text(),b={};b.userId=a;a=JSON.parse(listuser(b));if(1==a.total){var c=a.accountList,a=c[0].userName,b=void 0==c[0].realName?"":c[0].realName,e=void 0==c[0].org?"":c[0].org,g=void 0==c[0].mobile?"":c[0].mobile,l=void 0==c[0].email?"":c[0].email,h=void 0==c[0].province?"":c[0].province,k=void 0==c[0].city?"":c[0].city,m=void 0==c[0].district?"":c[0].district,n=void 0==c[0].address?"":c[0].address,c=void 0==c[0].status?"":c[0].status;$("#userName").val(a);$("#password").val("");$("#realname").val(b);$("#userType").css("display","none");$("#childorgList option:contains("+e+")").attr("selected","selected");$("#mobile").val(g);$("#email").val(l);$("#users1 option[value\x3d"+h+"]").attr("selected",!0);change(1,f);$("#users2 option[value\x3d"+k+"]").attr("selected",!0);change(2,f);$("#users3 option[value\x3d"+m+"]").attr("selected",!0);$("#userdetailaddress").val(n);$("input[name\x3disEnableRadio][value\x3d"+c+"]").attr("checked",!0)}})}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});var n,p,h,g,x=$(".validateTips"),u={root:"root",superr:"\u8d85\u7ea7\u7ba1\u7406\u5458",admin:"\u7ba1\u7406\u5458",common:"\u666e\u901a\u7528\u6237"};n=$("#add-user").dialog({autoOpen:!1,height:540,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=v()&&n.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){n.dialog("close")},"class":"cancel"}]});p=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){p.dialog("close")},"class":"sure"}]});h=$("#deltip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){a=$(this).dialog("option","_button");h.dialog("close");if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=$(this).parent().parent().children("td").eq(0).text();"success"==JSON.parse(deleteuser(a)).errCode?$(this).parent().parent().remove():alert("\u5220\u9664\u7528\u6237\u5931\u8d25\uff01")});else{var d=a.parent().parent().children("td").eq(0).text();"success"==JSON.parse(deleteuser(d)).errCode&&a.parent().parent().remove()}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){h.dialog("close")},"class":"cancel"}]});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),w(a),$("#userName").attr("readonly",!0),n.dialog("open"),n.dialog({title:"\u4fee\u6539\u5b50\u7528\u6237"}),x.text("\u4fee\u6539\u5b50\u7528\u6237\u4fe1\u606f")):p.dialog("open")});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?p.dialog("open"):(h.dialog("option","_button","del"),h.dialog("open"))});$(document).on("click",".delUser",function(){h.dialog("option","_button",$(this));h.dialog("open")});$("#searchType").change(function(){var a=$("#searchType option:selected").val();"all"==a?($("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"userName"==a?($("#searchByName").css("display","inline"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"location"==a?($("#searchByAddress").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByType").css("display","none")):"userType"==a&&($("#searchByType").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"))});$("#searchpng").click(function(){var a={},d=$("#searchType option:selected").val();if("userName"==d){d=$("#searchByName").val().trim();if(""==d)return alert("\u7ec4\u7ec7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;a.userName=d}else if("location"==d){var d=$("#search1 option:selected").text().trim(),b=$("#search2 option:selected").text().trim(),c=$("#search3 option:selected").text().trim();a.location={};if("\u7701\u4efd"==d&&"\u5730\u7ea7\u5e02"==b&&"\u5e02\u3001\u533a\u3001\u53bf"==c)return alert("\u7701\u3001\u5e02\u3001\u533a\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\uff01"),!1;"\u7701\u4efd"==d&&"\u5730\u7ea7\u5e02"==b?a.location.disctrict=c:"\u5730\u7ea7\u5e02"==b&&"\u5e02\u3001\u533a\u3001\u53bf"==c?a.location.province=d:"\u7701\u4efd"==d&&"\u5e02\u3001\u533a\u3001\u53bf"==c&&(a.location.city=b)}else"userType"==d&&(d=$("#searchByType option:selected").val(),a.type=d);a.faId=e.id;t(a)});var e=JSON.parse(getCookie("userselected")),r=getCookie("userCurrentPage");setCookie("backCurrentPage",r);(function(){var a=getCookie("userInfo");console.log("cookie\x3d"+a);g=JSON.parse(a).account})();g.userId!=e.id&&($(".update").css("display","none"),$(".del").css("display","none"));r={};r.faId=e.id;t(r);(function(){$("#fatherName").text(e.userName);$("#fatherType").text(e.type);$("#fatherAppName").text(e.appName);$("#fatherOrgName").text(e.org);$("#fatherRealName").text(e.realName);$("#fatherTel").text(e.mobile);$("#fatherState").text(e.status);"common"==g.type?$(".add").css("display","none"):"admin"==g.type||"superr"==g.type?($(".radio1").css("display","none"),$(".radio2").css("display","none"),$(".radio3").css("display","inline"),$(".radio4").css("display","inline")):($(".radio3").css("display","none"),$(".radio4").css("display","none"),$(".radio1").css("display","inline"),$(".radio2").css("display","inline"));if("root"==g.type||"superr"==g.type){$(".orgselect").css("display","block");var a={all:""};a.orgId=g.orgId;a=listorg(a);a=JSON.parse(a);if("success"==a.errCode)for(var a=a.orgList,d=0;d<a.length;d++){var b=JSON.stringify(a[d]),c=a[d].name;$("\x3coption value\x3d'"+b.replace(/\s/g,"")+"'\x3e"+c+"\x3c/option\x3e").appendTo($("#childorgList"))}}else $(".orgselect").css("display","none")})();var k=[];k.push("s1");k.push("s2");k.push("s3");setup(k);var f=[];f.push("users1");f.push("users2");f.push("users3");setup(f);var m=[];m.push("search1");m.push("search2");m.push("search3");setup(m);$("#s1").change(function(){change(1,k)});$("#s2").change(function(){change(2,k)});$("#s3").change(function(){change(3,k)});$("#search1").change(function(){change(1,m)});$("#search2").change(function(){change(2,m)});$("#search3").change(function(){change(3,m)});$("#users1").change(function(){change(1,f)});$("#users2").change(function(){change(2,f)});$("#users3").change(function(){change(3,f)})});