$(function(){function I(){var a=$("#O2").val().trim(),b=$("#CO").val().trim(),C=$("#CO2").val().trim(),d=$("#NO").val().trim(),D=$("#NO2").val().trim(),g=$("#yanwen").val().trim(),e=$("#NOx").val().trim(),l=$("#SO2").val().trim(),E=$("#jingxiaolv").val().trim(),F=$("#maoxiaolv").val().trim(),p=$("#bengliuliang").val().trim(),f=[],m=/^[0-9]+.?[0-9]*$/,k={},n={},q={},r={},t={},u={},v={},w={},x={},y={},z={},A={},B={};if(""!=a&&!m.test(a))return $(".confirmMsg").html("O2\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=a&&(q.family=h[1],q.unit=c[1],q.value=Number(a),q.vtype=c[14],f.push(q));if(""!=b&&!m.test(b))return $(".confirmMsg").html("CO\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=b&&(r.family=h[2],r.unit=c[2],r.value=Number(b),r.vtype=c[14],f.push(r));if(""!=C&&!m.test(C))return $(".confirmMsg").html("CO2\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=C&&(t.family=h[3],t.unit=c[3],t.value=Number(C),t.vtype=c[14],f.push(t));if(""!=d&&!m.test(d))return $(".confirmMsg").html("NO\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=d&&(u.family=h[4],u.unit=c[4],u.value=Number(d),u.vtype=c[14],f.push(u));if(""!=D&&!m.test(D))return $(".confirmMsg").html("NO2\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=D&&(v.family=h[5],v.unit=c[5],v.value=Number(D),v.vtype=c[14],f.push(v));if(""!=g&&!m.test(g))return $(".confirmMsg").html("\u70df\u6e29\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=g&&(w.family=h[6],w.unit=c[6],w.value=Number(g),w.vtype=c[14],f.push(w));if(""!=e&&!m.test(e))return $(".confirmMsg").html("NOx\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=e&&(x.family=h[7],x.unit=c[7],x.value=Number(e),x.vtype=c[14],f.push(x));if(""!=l&&!m.test(l))return $(".confirmMsg").html("SO2\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=l&&(y.family=h[8],y.unit=c[8],y.value=Number(l),y.vtype=c[14],f.push(y));if(""!=E&&!m.test(E))return $(".confirmMsg").html("\u51c0\u6548\u7387\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=E&&(z.family=h[9],z.unit=c[9],z.value=Number(E),z.vtype=c[14],f.push(z));if(""!=F&&!m.test(F))return $(".confirmMsg").html("\u6bdb\u6548\u7387\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=F&&(A.family=h[10],A.unit=c[10],A.value=Number(F),A.vtype=c[14],f.push(A));if(""!=p&&!m.test(p))return $(".confirmMsg").html("\u6cf5\u6d41\u91cf\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01"),!1;""!=p&&(B.family=h[12],B.unit=c[12],B.value=Number(p),B.vtype=c[14],f.push(B));if(null==G)return $(".confirmMsg").html("\u8bf7\u9009\u62e9\u767b\u8bb0\u65f6\u95f4\uff01"),!1;a=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text());n.uId=a.id;n.name=a.name;k.time=G.getTime();k.factory=n;k.location=a.location;k.items=f;"success"!=JSON.parse(manvcreate(k)).errCode&&alert("\u6dfb\u52a0\u5931\u8d25!")}function H(a){$(".orgTable tbody").empty();$(".orgTable tbody").html("");a=listorg(a);a=JSON.parse(a);if("success"==a.errCode){a=a.orgList;for(var b=0;b<a.length;b++){var c=void 0==a[b].name?"":a[b].name,d=void 0==a[b].location?"":a[b].location,g=""==d?"":void 0==d.province?"":d.province,h=""==d?"":void 0==d.city?"":d.city,k=""==d?"":void 0==d.district?"":d.district,d=""==d?"":void 0==d.address?"":d.address,l={},e={},n={},p={},f={};l.asc="time";e.max=1;e.start=0;f.name=c;f.uId=a[b].id;n.factory=f;p.sort=l;p.filter={include:"time"};l=JSON.parse(manvListNow(n,e,p));l="success"==l.errCode?J(1E3*l.poluList[0].time,"yyyy/MM/dd HH:mm:ss"):"\u672a\u5f55\u5165";e="data"+(b+1);$(".orgTable tbody").append("\x3ctr id\x3d'org_"+(b+1)+"'\x3e\x3ctd style\x3d'display: none'\x3e"+JSON.stringify(a[b])+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+(b+1)+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+(b+1)+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+g+h+k+d+"\x3c/td\x3e\x3ctd\x3e"+l+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../environmental/manualIndicatorList.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+e+"'\x3e \u67e5\u770b\u6570\u636e\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+e,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("indicatorFactory",a)})}sorter.init("orgTable",2)}}function J(a,b){var c=new Date(a),d=function(a){return(10>a?"0":"")+a};return b.replace(/yyyy|MM|dd|HH|mm|ss/g,function(a){switch(a){case "yyyy":return d(c.getFullYear());case "MM":return d(c.getMonth()+1);case "mm":return d(c.getMinutes());case "dd":return d(c.getDate());case "HH":return d(c.getHours());case "ss":return d(c.getSeconds())}})}var g,G,n,k,K={elem:"#recordTime",istime:!0,isclear:!1,istoday:!1,format:"YYYY/MM/DD hh:mm:ss",issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(a){G=new Date(a)}};$("#recordTime").click(function(){laydate(K)});n=$("#add-data").dialog({autoOpen:!1,height:450,width:750,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=I()&&n.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){n.dialog("close")},"class":"cancel"}],close:function(){G=null;$("#O2").val("");$("#CO").val("");$("#CO2").val("");$("#NO").val("");$("#NO2").val("");$("#yanwen").val("");$("#NOx").val("");$("#SO2").val("");$("#jingxiaolv").val("");$("#maoxiaolv").val("");$("#bengliuliang").val("");$("#recordTime").val("")}});k=$("#import-data").dialog({autoOpen:!1,height:350,width:580,modal:!0,buttons:[{text:"\u5bfc\u5165",click:function(){$(".confirmMsg").html("");var a=document.getElementById("fileName");if(""==$("#fileName").val())return $(".confirmMsg").html("\u8bf7\u5148\u9009\u62e9\u6587\u4ef6\uff01"),!1;$("#progressbar").css("display","block");var b=k.dialog("option","_button");uploadfile(b,a,2)},"class":"sure"},{text:"\u5173\u95ed",click:function(){k.dialog("close")},"class":"cancel"}],close:function(){$("#fileName").val("");$("#showFile").val("");$(".confirmMsg").html("");$("#progressbar").css("display","none")}});g=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){g.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){g.dialog("close")},"class":"cancel"}]});$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3dcheckbox][type\x3dcheckbox]").each(function(){$(this).prop("checked",!0)}):$("input[type\x3dcheckbox][name\x3dcheckbox]").each(function(){$(this).prop("checked",!1)})});$("#showFile").click(function(){$("#fileName").click()});$("#browse").click(function(){$("#fileName").click()});$("#fileName").change(function(){$("#showFile").val($(this).val())});$(".addData").click(function(){var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),b=a.length;g.dialog("option","title","\u624b\u52a8\u6dfb\u52a0\u6570\u636e\u63d0\u793a\u4fe1\u606f");1!=b?($("#tip .tipright p").html("\u5f53\u524d\u9700\u8981\u4e14\u53ea\u80fd\u9009\u62e9\u4e00\u6761\u6570\u636e\u8fdb\u884c\u6dfb\u52a0\u6570\u636e\uff01"),g.dialog("open")):"factory"!=JSON.parse(a.parent().parent().children("td").eq(0).text()).type?($("#tip .tipright p").html("\u8bf7\u9009\u62e9\u5de5\u5382\u7c7b\u578b\u7684\u7ec4\u7ec7\uff01"),g.dialog("open")):n.dialog("open")});$(".importDataDialog").click(function(){var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),b=a.length;g.dialog("option","title","\u5bfc\u5165excel\u6570\u636e\u63d0\u793a\u4fe1\u606f");1!=b?($("#tip .tipright p").html("\u5f53\u524d\u9700\u8981\u4e14\u53ea\u80fd\u9009\u62e9\u4e00\u6761\u6570\u636e\u8fdb\u884c\u5bfc\u5165excel\u6570\u636e\uff01"),g.dialog("open")):(a=JSON.parse(a.parent().parent().children("td").eq(0).text()),"factory"!=a.type?($("#tip .tipright p").html("\u8bf7\u9009\u62e9\u5de5\u5382\u7c7b\u578b\u7684\u7ec4\u7ec7\uff01"),g.dialog("open")):($("#progressbar").css("display","none"),k.dialog("option","_button",a),k.dialog("open")))});$("#searchType").change(function(){var a=$("#searchType option:selected").text();"\u5168\u90e8"==a?($("#searchByName").css("display","none"),$("#searchByAddress").css("display","none")):"\u5355\u4f4d\u540d\u79f0"==a?($("#searchByName").css("display","inline"),$("#searchByAddress").css("display","none")):"\u5355\u4f4d\u5730\u5740"==a&&($("#searchByAddress").css("display","inline"),$("#searchByName").css("display","none"))});$("#searchpng").click(function(){var a={},b=$("#searchType option:selected").text();if("\u5168\u90e8"==b)a.all="";else if("\u5355\u4f4d\u540d\u79f0"==b){b=$("#searchByName").val().trim();if(""==b)return alert("\u7ec4\u7ec7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;a.name=b}else if("\u5355\u4f4d\u5730\u5740"==b){var b=$("#search1 option:selected").text().trim(),c=$("#search2 option:selected").text().trim(),d=$("#search3 option:selected").text().trim();a.location={};if("\u7701\u4efd"==b&&"\u5730\u7ea7\u5e02"==c&&"\u5e02\u3001\u533a\u3001\u53bf"==d)return alert("\u7701\u3001\u5e02\u3001\u533a\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\uff01"),!1;"\u7701\u4efd"!=b&&(a.location.province=b);"\u5730\u7ea7\u5e02"!=c&&(a.location.city=c);"\u5e02\u3001\u533a\u3001\u53bf"!=d&&(a.location.disctrict=d)}a.type="factory";H(a)});H({type:"factory"});var h="\u8fd0\u884c\u65f6\u95f4 O2 CO CO2 NO NO2 \u70df\u6e29 NOx SO2 \u51c0\u6548\u7387 \u6bdb\u6548\u7387 \u73af\u6e29 \u6cf5\u6d41\u91cf \u7a00\u91ca\u500d\u6570".split(" "),c="ms %25 ppm %25 ppm ppm \u2103 ppm ppm %25 %25 \u2103 l/min \u500d Double".split(" "),e=[];e.push("search1");e.push("search2");e.push("search3");setup(e);$("#search1").change(function(){change(1,e)});$("#search2").change(function(){change(2,e)})});window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.update();