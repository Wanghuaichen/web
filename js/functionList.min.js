$(function(){function l(a){$("#appTable tbody").empty();$("#appTable tbody").html("");for(var b=0;b<a.length;b++)$("#appTable tbody").append("\x3ctr id\x3d'functionList_"+(b+1)+"'\x3e\x3ctd style\x3d'display: none'\x3e"+a+"\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+(b+1)+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+(b+1)+"\x3c/td\x3e\x3ctd\x3e"+a[b]+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#' class\x3d'delApp tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");sorter.init("appTable",1)}function n(){var a=$("#add-app").dialog("option","title"),b=$("#appName").val().trim();if(""==b)return $(".confirmMsg").html("\u529f\u80fd\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;c=void 0==e.funcPerm?[]:e.funcPerm;if("\u6dfb\u52a0\u529f\u80fd"==a){console.log("functionPerm\x3d"+c);for(var a="",d=0;d<c.length;d++)a+=c[d]+"|";d={};d.funcPerm=a+b;"success"==JSON.parse(updateapp(e.id,e.seen,d)).errCode?(c.push(b),e.funcPerm=c,a=$("#appTable tbody tr").length+1,$("#appTable tbody").append("\x3ctr id\x3d'app"+a+"'\x3e\x3ctd style\x3d'display: none'\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' type\x3d'checkbox' id\x3d'checkbox_"+a+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#' class\x3d'delApp tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e")):alert("\u6dfb\u52a0\u5931\u8d25\uff01")}else{if(b==h)return $(".confirmMsg").html("\u529f\u80fd\u540d\u79f0\u6ca1\u6709\u505a\u4efb\u4f55\u4fee\u6539\uff01"),!1;for(d=0;d<c.length;d++)c[d]==h&&(c[d]=b);a="";for(d=0;d<c.length;d++)a+=c[d]+"|";a=a.substring(0,a.length-1);d={};d.funcPerm=a;"success"==JSON.parse(updateapp(e.id,e.seen,d)).errCode?(e.funcPerm=c,$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){$(this).parent().parent().children("td").eq(3).text(b)})):alert("\u4fee\u6539\u5931\u8d25\uff01")}}function p(a){a.each(function(){h=$(this).parent().parent().children("td").eq(3).text();$("#appName").val(h)});f.dialog("open");f.dialog({title:"\u4fee\u6539\u529f\u80fd"});m.text("\u4fee\u6539\u529f\u80fd\u4fe1\u606f")}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});var f,k,g,m=$(".validateTips");f=$("#add-app").dialog({autoOpen:!1,height:280,width:500,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=n()&&f.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){f.dialog("close")},"class":"cancel"}]});k=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){k.dialog("close")},"class":"sure"}]});g=$("#deltip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){a=$(this).dialog("option","_button");g.dialog("close");c=void 0==e.funcPerm?[]:e.funcPerm;if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=$(this).parent().parent().children("td").eq(3).text();c.splice($.inArray(a,c),1);$(this).parent().parent().remove()});else{var b=a.parent().parent().children("td").eq(3).text();c.splice($.inArray(b,c),1);a.parent().parent().remove()}a="";for(b=0;b<c.length;b++)a+=c[b]+"|";a=a.substring(0,a.length-1);""==a&&(a="null");b={};b.funcPerm=a;"success"!=JSON.parse(updateapp(e.id,e.seen,b)).errCode&&alert("\u5220\u9664\u529f\u80fd"+a+"\u5931\u8d25\uff01")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){g.dialog("close")},"class":"cancel"}]});$(".add").click(function(){$(".confirmMsg").html("");$("#appName").val("");f.dialog("open");f.dialog({title:"\u6dfb\u52a0\u529f\u80fd"});m.text("\u6dfb\u52a0\u529f\u80fd\u4fe1\u606f")});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),p(a)):k.dialog("open")});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?k.dialog("open"):(g.dialog("option","_button","del"),g.dialog("open"))});$(document).on("click",".delApp",function(){g.dialog("option","_button",$(this));g.dialog("open")});$("#searchType").change(function(){var a=$("#searchType option:selected").text();"\u5168\u90e8"==a?($("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"\u540d\u79f0"==a?($("#searchByName").css("display","inline"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"\u7c7b\u578b"==a&&($("#searchByType").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"))});$("#searchpng").click(function(){var a={},b=$("#searchType option:selected").text();if("\u5168\u90e8"==b)a.all="";else if("\u540d\u79f0"==b){b=$("#searchByName").val().trim();if(""==b)return alert("\u5e94\u7528\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;a.appName=b}else"\u7c7b\u578b"==b&&(b=$("#searchByType option:selected").val(),a.scope=b);l(a)});var e=JSON.parse(getCookie("functionlist")),c=void 0==e.funcPerm?"":e.funcPerm,h;l(c)});