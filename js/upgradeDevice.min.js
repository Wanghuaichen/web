$(function(){function p(a,e,b,l,g,u,c,d){var h="detail"+a;$("#deviceTable tbody").append("\x3ctr id\x3d'device_"+a+"'\x3e\x3ctd style\x3d'display: none'\x3e"+e+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+a+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+l+"\x3c/td\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3ctd\x3e"+u+"\x3c/td\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../devices/UpgradeDeviceDetail.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+h+"'\x3e\u8be6\u60c5\x3c/a\x3e \x3ca href\x3d'javascript:void(0)' class\x3d'delUser tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+h,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("upgradeselected",a);setCookie("upgradeCurrentPage",$("#currentpage").text())})}function v(){var a=$("#add-device").dialog("option","title"),e=$("#name").val().trim(),b=$("#fname").val().trim(),l=$("#version").val().trim(),g=$("#dtype option:selected").text(),c=$("#url").val().trim(),f=$("input[name\x3dradio]:checked").val();if(""==e)return $(".confirmMsg").html("\u8f6f\u4ef6\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==b)return $(".confirmMsg").html("\u6587\u4ef6\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==l)return $(".confirmMsg").html("\u7248\u672c\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==g)return $(".confirmMsg").html("\u8bbe\u5907\u7c7b\u578b\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if(""==c)return $(".confirmMsg").html("\u5b58\u653e\u4f4d\u7f6e\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;var d={};d.name=e;d.version=l;d.url=c;d.fname=b;d.state=f;if("\u6dfb\u52a0"==a)if(d=upgradeCreate(g,e,d),a=JSON.parse(d),"success"==a.errCode){var h={},d={};h.id=a.id;h.name="name";h.dtype=g;h.swInfo=d;d=JSON.stringify(h);a=$("#deviceTable tbody tr").length+1;p(a,d,e,b,l,g,c,f)}else return $(".confirmMsg").html("\u521b\u5efa\u5347\u7ea7\u4fe1\u606f\u5931\u8d25\uff0c"+a.errCode+"!"),!1;else if(a=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),d=JSON.parse(upgradeUpdate(a.id,e,g,d)),"success"==d.errCode)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent().attr("id");$("tr[id\x3d'"+a+"']").children("td").eq(3).text(e);$("tr[id\x3d'"+a+"']").children("td").eq(4).text(b);$("tr[id\x3d'"+a+"']").children("td").eq(5).text(l);$("tr[id\x3d'"+a+"']").children("td").eq(7).text(g);$("tr[id\x3d'"+a+"']").children("td").eq(8).text(c);$("tr[id\x3d'"+a+"']").children("td").eq(9).text(f)});else return $(".confirmMsg").html("\u4fee\u6539\u5347\u7ea7\u4fe1\u606f\u5931\u8d25\uff0c"+d.errCode+"!"),!1}function w(a){a.each(function(){JSON.parse($(this).parent().parent().children("td").eq(0).text());var a=$(this).parent().parent().children("td").eq(3).text(),b=$(this).parent().parent().children("td").eq(4).text(),c=$(this).parent().parent().children("td").eq(5).text(),f=$(this).parent().parent().children("td").eq(6).text(),k=$(this).parent().parent().children("td").eq(7).text(),m=$(this).parent().parent().children("td").eq(8).text();$("#name").val(a);$("#fname").val(b);$("#version").val(c);$("#url").val(k);q();$("#dtype option").each(function(){var a=$(this).text();f==a&&$(this).attr("selected",!0)});$("input[name\x3dradio][value\x3d"+m+"]").val()})}function q(){var a=JSON.parse(getCookie("userInfo")),e={};e.orgId=a.account.orgId;a=JSON.parse(devtypeList(e));if("success"==a.errCode){a=a.resultList;$("#dtype").empty();for(var b in a){var e=JSON.stringify(a[b]),c=a[b].type;$("\x3coption value\x3d"+e.replace(/\s/g,"")+"\x3e"+c+"\x3c/option\x3e").appendTo($("#dtype"))}}}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});var k,c,f,r=$(".validateTips");k=$("#add-device").dialog({autoOpen:!1,height:400,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=v()&&k.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){k.dialog("close")},"class":"cancel"}]});tipdialog=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){tipdialog.dialog("close")},"class":"sure"}]});c=$("#deltip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){a=$(this).dialog("option","_button");c.dialog("close");if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=JSON.parse($(this).parent().parent().children("td").eq(0).text());"success"==JSON.parse(upgradeDelete(a.id)).errCode?$(this).parent().parent().remove():alert("\u5220\u9664\u5347\u7ea7\u4fe1\u606f "+a.name+"\u5931\u8d25\uff01")});else{var e=JSON.parse(a.parent().parent().children("td").eq(0).text());"success"==JSON.parse(upgradeDelete(e.id)).errCode?a.parent().parent().remove():alert("\u5220\u9664\u5347\u7ea7\u4fe1\u606f "+e.name+"\u5931\u8d25\uff01")}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){c.dialog("close")},"class":"cancel"}]});$(".add").click(function(){$(".confirmMsg").html("");$("#name").val("");$("#fname").val("");$("#version").val("");$("#dtype").val("");$("#url").val("");q();k.dialog("open");r.text("\u6dfb\u52a0\u5347\u7ea7\u7248\u672c\u4fe1\u606f")});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),w(a),k.dialog("open"),k.dialog({title:"\u4fee\u6539"}),r.text("\u4fee\u6539\u5347\u7ea7\u4fe1\u606f")):tipdialog.dialog("open")});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?tipdialog.dialog("open"):(c.dialog("option","_button","del"),c.dialog("open"))});$(document).on("click",".delUser",function(){c.dialog("option","_button",$(this));c.dialog("open")});$("#searchType").change(function(){var a=$("#searchType option:selected").val();"all"==a?$("#searchByName").css("display","none"):"fileName"==a&&($("#searchByName").css("display","inline"),$("#searchByName").val(""))});$("#searchpng").click(function(){var a=$("#searchType option:selected").val();if("all"!=a&&"fileName"==a&&""==$("#searchByName").val().trim())return alert("\u6587\u4ef6\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1});f=getCookie("userInfo");var m;console.log("cookie\x3d"+f);f=JSON.parse(f).account;var n={};if("root"==f.type||"superr"==f.type)n.all="";else{var t={};t.name=f.userName;n.account=t}(function(a){$("#deviceTable tbody").empty();$("#deviceTable tbody").html("");a=upgradeList("all");m=JSON.parse(a);if("success"==m.errCode){a=m.upgradeList;for(var c=a.length,b=0;b<c;b++){var f=JSON.stringify(a[b]);p(b+1,f,a[b].name,a[b].swInfo.fname,a[b].swInfo.version,a[b].dtype,a[b].swInfo.url,a[b].swInfo.state)}sorter.init("deviceTable",2);null!=getCookie("backCurrentPage")&&(sorter.transferToPage(Number(getCookie("backCurrentPage"))),delCookie("backCurrentPage"))}})(n)});