$(function(){function h(d,m){$("#indicatorTable tbody").empty();$("#indicatorTable tbody").html("");if(void 0==e||null==d&&null==m){var f={},n=[],a=0;f.all="";f=JSON.parse(listdevice(f));if("success"==f.errCode&&0!=f.total){e={};var p=f.deviceList,h=[],l={},f=0;l.start=(new Date(r)).getTime();l.end=(new Date(v)).getTime();l.space=18E4;for(c in p){var q=JSON.stringify(p[c]),x=p[c].id,y=void 0==p[c].type?"":p[c].type,g=void 0==p[c].subs?"":p[c].subs;e[x]=q;var k={},t={};k.id=x;k.time=l;k.devType=y;n[a]=y;a++;t.find=k;h.push(t);for(b in g){var k={},t={},q=g[b].pid,z=void 0==g[b].type?y:g[b].type;k.id=x;k.subId=q;k.time=l;k.devType=z;n[a]=z;a++;t.find=k;h.push(t)}}c={};c.multiFind=h;var c=JSON.parse(listhiststate(c)).multiResult,u;for(u in c)b=c[u],"success"==b.errCode&&(f++,g=b.resultList,b=b.id.split("|"),g=g[g.length-1].A,a=JSON.parse(e[b[0]]),a.lastTime=g,a.subId=b[1],e[b[0]]=JSON.stringify(a),w(f,e[b[0]],a.name,dataFormate(g,"yyyy/MM/dd HH:mm:ss"),b[1],n[u],a.org));0!=f&&(sorter.init("indicatorTable",1),null!=getCookie("deviceAlarmBackCurrentPage")&&(sorter.transferToPage(Number(getCookie("deviceAlarmBackCurrentPage"))),delCookie("deviceAlarmBackCurrentPage")))}}else{var n=0,c;for(c in e)if(a=JSON.parse(e[c]),void 0!=a.lastTime){var g=a.subs,b;for(b in g)if(q=g[b].pid,u=g[b].type,null!=m&&(new RegExp(m)).test(a.name)||null!=d&&(new RegExp(d)).test(q))n++,w(n,e[c],a.name,dataFormate(a.lastTime,"yyyy/MM/dd HH:mm:ss"),q,u,a.org)}0!=n&&sorter.init("indicatorTable",1)}}function w(d,m,f,h,a,e,w){var l="detail"+d;$("#indicatorTable tbody").append("\x3ctr id\x3d'app_"+d+"'\x3e\x3ctd style\x3d'display: none'\x3e"+m+"\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3ctd\x3e"+dataFormate(h,"yyyy/MM/dd HH:mm:ss")+"\x3c/td\x3e\x3ctd\x3e"+w+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'deviceAlarmDetail.html' class\x3d'tablelink'target\x3d'rightFrame' id\x3d'"+l+"'\x3e \u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3c/tr\x3e");$(document).on("click","#"+l,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("deviceAlarm",a);a={};a.startTime=r;a.endTime=v;setCookie("alarmInfo",JSON.stringify(a));setCookie("deviceAlarmCurrentPage",$("#currentpage").text())})}function A(d,m){return{elem:"#starthour",istime:d,isclear:!1,istoday:!1,format:m,issure:!1,start:laydate.now(0),max:laydate.now(0),choose:function(f){r=f;h()}}}function B(d){return{elem:"#endhour",istime:!0,isclear:!1,istoday:!1,format:"YYYY/MM/DD hh:mm:ss",issure:!1,start:laydate.now(0),min:d,max:laydate.now(0),choose:function(d){v=d;h()}}}$("#searchType").change(function(){$("#searchByName").val("")});$("#searchpng").click(function(){var d=$("#searchType option:selected").val(),e=$("#searchByName").val();""!=e&&("factoryName"==d?h(null,e):h(e,null))});$("#starthour").click(function(){$("#enrollmentType option:selected").val();laydate(A(!0,"YYYY/MM/DD hh:mm:ss"));addLaydateListener()});$("#endhour").click(function(){laydate(B(r));$("#laydate_ms span").click(function(){addLaydateListener()});$("#laydate_ys li").click(function(){addLaydateListener()});addLaydateListener()});var r=dataFormate((new Date).getTime()-864E5,"yyyy/MM/dd HH:mm:ss"),v=dataFormate((new Date).getTime(),"yyyy/MM/dd HH:mm:ss");$("#starthour").val(r);$("#endhour").val(v);var e;h()});