/**
 * Created by admin on 2015/11/17.
 */$(function(){function x(a,e){var b={};b.family=a;var c={},d={};c.max="2000";c.start="0";d.sort={asc:"time"};b=datanow(b,c,d);b=JSON.parse(b);if("success"==b.errCode)for(b=b.poluList,c=b.length,d=0;d<c;d++)JSON.stringify(b[d])}function y(){var a={},e={};a.max="2000";a.start="0";e.family=v;var b={},c=$("#searchType option:selected").val(),d=new Date(l);b.end=(new Date(m)).getTime()+(864E5-1);"hour"==c&&(b.scale="hour",b.end-=864E5-1);"day"==c?b.scale="day":"month"==c?b.scale="month":"year"==c?b.scale="year":"minute"==c?(b.scale="minute",b.end-=864E5-1):"minute10"==c?(b.scale="minute10",b.end-=864E5-1):"all"==c&&(b.scale="all");d=new Date(d.getTime());b.start=d.getTime();e.time=b;e.uid=indicatorId;a=datahistory(e,a,{});c=JSON.parse(a);b=e=a=0;if("success"==c.errCode&&0!=c.total){var c=c.resultList,d=/^-?\d+(\.\d+)?$/,f;for(f in c)for(var g in c[f]){var q=c[f][g],k=void 0==c[f].day?"":c[f].day,r;for(r in q)if(void 0==q[r].dvalue){var n=void 0==q[r].values?"":q[r].values,p;for(p in n){var t=void 0==n[p].min?"":Number(n[p].min).toFixed(3),u=void 0==n[p].max?"":Number(n[p].max).toFixed(3),h=void 0==n[p].avg?"":Number(n[p].avg).toFixed(3),t=Number(t),u=Number(u);k.substring(0,4);k.substring(4,6);k.substring(6,8);1==d.test(h)&&1==d.test(t)&&1==d.test(u)&&(0==b&&(e=u,a=t),b++,u>e&&(e=u),t<a&&(a=t))}}else h=void 0==q[r].dvalue?"":Number(q[r].dvalue).toFixed(3),1==d.test(h)&&(0==b&&(a=e=h),b++,h>e&&(e=h),h<a&&(a=h))}}}function z(a,e,b,c){a={elem:"#starthour",istime:a,isclear:!1,istoday:!1,format:c,issure:!1,start:e,max:b,choose:function(a){l=a}};l=a.start;return a}function A(a,e,b,c,d){a={elem:"#endhour",istime:a,isclear:!1,istoday:!1,format:d,issure:!1,start:e,min:b,max:c,choose:function(a){m=a}};m=a.start;return a}function g(a,e,b,c){var d="YYYY/MM/DD",f=!1;if("minute"==a||"minute10"==a||"hour"==a)d="YYYY/MM/DD hh:mm:ss",f=!0;e&&(z(f,laydate.now(-2),laydate.now(0),d),A(f,laydate.now(0),l,laydate.now(0),d));b&&laydate(z(f,l,laydate.now(0),d));c&&laydate(A(f,m,l,laydate.now(0),d));$("#starthour").val(l);$("#endhour").val(m)}function k(a){B=(new Date).getTime();a&&(w=setInterval(function(){C=(new Date).getTime();6E5<=C-B?(tipdialog.dialog("option","title","\u63d0\u793a\u4fe1\u606f"),$("#tip .tipright p").html("\u662f\u5426\u7ee7\u7eed\u76d1\u63a7\u5b9e\u65f6\u6570\u636e\uff01"),tipdialog.dialog("option","_button","overtime"),tipdialog.dialog("open")):x(v,3E4)},1E4),$(document).mousemove(function(){k(!1)}),$(document).click(function(){k(!1)}))}var w,B=0,C=0;k(!0);g("hour",!0);$("#realtime").click(function(){clearInterval(w);k(!0);x(v)});$("#history").click(function(){clearInterval(w);chartType="line";$("#searchType option[value\x3d'hour']").attr("selected",!0);y()});$("#searchType").change(function(){var a=$("#searchType option:selected").val();"minute"==a||"minute10"==a?g("minute"):g("hour")});var m,l;$("#starthour").click(function(){var a=$("#searchType option:selected").val();"minute"==a||"minute10"==a?g("minute",!1,!0):g("hour",!1,!0)});$("#endhour").click(function(){var a=$("#searchType option:selected").val();"minute"==a||"minute10"==a?g("minute",!1,!1,!0):g("hour",!1,!1,!0)});$("#searchpng").click(function(){if(""==m||void 0==m)return alert("\u8bf7\u5148\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"),!1;y()});var v=getCookie("monitorMenu")});window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.update();