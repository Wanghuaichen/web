$(function(){function k(a){$("#devTypeTable tbody").empty();$("#devTypeTable tbody").html("");a=JSON.parse(devtypeList(a));if("success"==a.errCode){a=a.resultList;for(var c=a.length,b=0;b<c;b++){var d=JSON.stringify(a[b]);l(d,b+1,a[b].type,void 0==a[b].info?"":a[b].info)}sorter.init("devTypeTable",2)}}function l(a,c,b,d){$("#devTypeTable tbody").append("\x3ctr id\x3d'app_"+c+"'\x3e\x3ctd style\x3d'display: none'\x3e"+a+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+c+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+c+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#' class\x3d'delApp tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e")}function n(a){a.each(function(){var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),b=a.type,a=void 0==a.info?"":a.info;$("#devType").val(b);$("#desInfo").val(a);e.dialog("open");e.dialog({title:"\u4fee\u6539\u8bbe\u5907\u7c7b\u578b"});m.text("\u4fee\u6539\u8bbe\u5907\u7c7b\u578b\u4fe1\u606f")})}function p(){var a=$("#addDevType").dialog("option","title"),c=$("#devType").val().trim(),b=$("#desInfo").val().trim();if(""==c)return $(".confirmMsg").html("\u8bbe\u5907\u7c7b\u578b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;var d=JSON.parse(getCookie("userInfo")).account;if("\u6dfb\u52a0\u8bbe\u5907\u7c7b\u578b"==a){a={};a.type=c;a.orgId=d.orgId;""!=b&&(a.info=b);d=JSON.parse(devtypeCreate(a));if("success"!=d.errCode)return $(".confirmMsg").html("\u6dfb\u52a0\u8bbe\u5907\u7c7b\u578b\u4fe1\u606f\u5931\u8d25\uff01"),!1;a={};a.id=d.id;a.type=c;a.info=b;d=JSON.stringify(a);a=$("#devTypeTable tbody tr").length+1;l(d,a,c,b)}else{var f=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),d={},a=void 0==f.info?"":f.info,e=0;f.type!=c&&(e++,d.type=c);a!=b&&(e++,d.info=b);if(0!=e){d.id=f.id;d=JSON.parse(devtypeUpdate(d));if("success"!=d.errCode)return $(".confirmMsg").html("\u4fee\u6539\u8bbe\u5907\u7c7b\u578b\u4fe1\u606f\u5931\u8d25\uff01"),!1;f.type=c;f.info=b;$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent().attr("id");$("tr[id\x3d'"+a+"']").children("td").eq(0).text(JSON.stringify(f));$("tr[id\x3d'"+a+"']").children("td").eq(3).text(c);$("tr[id\x3d'"+a+"']").children("td").eq(4).text(b)})}else return $(".confirmMsg").html("\u4fe1\u606f\u6ca1\u6709\u505a\u4efb\u4f55\u4fee\u6539\uff01"),!1}}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});var e,g,h,m=$(".validateTips");e=$("#addDevType").dialog({autoOpen:!1,height:400,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=p()&&e.dialog("close")},"class":"sure"},{text:"\u5173\u95ed",click:function(){e.dialog("close")},"class":"cancel"}],close:function(){$("#devType").val("");$("#desInfo").val("");$(".confirmMsg").html("")}});h=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){h.dialog("close")},"class":"sure"}]});g=$("#deltip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){a=$(this).dialog("option","_button");g.dialog("close");if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text()),b={};b.id=a.id;"success"==JSON.parse(devtypeDelete(b)).errCode?$(this).parent().parent().remove():alert("\u5220\u9664\u8bbe\u5907\u7c7b\u578b\u5931\u8d25\uff01")});else{var c=JSON.parse(a.parent().parent().children("td").eq(0).text()),b={};b.id=c.id;"success"==JSON.parse(devtypeDelete(b)).errCode?a.parent().parent().remove():alert("\u5220\u9664\u8bbe\u5907\u7c7b\u578b\u5931\u8d25\uff01")}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){g.dialog("close")},"class":"cancel"}]});$(".add").click(function(){e.dialog("open");e.dialog("open");e.dialog({title:"\u6dfb\u52a0\u8bbe\u5907\u7c7b\u578b"});m.text("\u6dfb\u52a0\u8bbe\u5907\u7c7b\u578b\u4fe1\u606f")});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),n(a)):h.dialog("open")});$(".del").click(function(){g.dialog("option","_button","del");g.dialog("open")});$(document).on("click",".delApp",function(){g.dialog("option","_button",$(this));g.dialog("open")});$("#searchType").change(function(){$("#searchType option:selected").text();$("#searchByName").val("")});$("#searchpng").click(function(){var a={},c=$("#searchType option:selected").text();if("\u5168\u90e8"==c)a.all="";else if("\u540d\u79f0"==c){c=$("#searchByName").val().trim();if(""==c)return alert("\u5e94\u7528\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;a.name=c}k(a)});k({all:""})});