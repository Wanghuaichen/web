$(function(){function q(){var a={},c=$("#indicatorselect option:selected").text().trim(),e=$("#factoryList option:selected").val().trim(),h;if(null!=e&&"\u5de5\u5382\u5217\u8868"!=e&&"success"==t.errCode&&0!=t.total){var g=t.resultList,l;for(l in g)if(g[l].factory.name==e){h=g[l].factory;break}e={};e.name=h.name;e.uId=h.id;a.factory=e;"All"!=c&&(a.family=c);c={};h={};c.max="50";c.start="0";e=$("#startDay").val();""!=e?(e=new Date(e),g={scale:"day"},g.start=e.getTime(),g.end=e.getTime(),a.time=g,a=datahistory(a,c,h)):(h.sort={asc:"time"},a=datanow(a,c,h));p=u=v=y=w=0;$("#indicatorTable tbody").empty();$("#indicatorTable tbody").html("");c=JSON.parse(a);if("success"==c.errCode&&0!=c.total){$("#showNoData").css("display","none");if(void 0==c.poluList){var k=$("#startDay").val(),a=c.resultList,d;for(d in a){var f=a[d].dayResult,b;for(b in f){c=void 0==f[b].factory.name?"":f[b].factory.name;h=void 0==f[b].family?"":f[b].family;e=void 0==f[b].name?"":f[b].name;g=void 0==f[b].max?"":f[b].max;l=void 0==f[b].min?"":f[b].min;var m=void 0==f[b].unit?"":f[b].unit,n=void 0==f[b].higher?"":f[b].higher,z=void 0==f[b].lower?"":f[b].lower,r="",x=null,q=void 0==f[b].devId?"":f[b].devId;f[b].id=f[b].uid;f[b].selectedDate=k;var B=JSON.stringify(f[b]);"yes"==n?(r="\u8d85\u4e0a\u9650",v++):"yes"==z?(r="\u8d85\u4e0b\u9650",u++):(r="\u6b63\u5e38",w++);var n=void 0==f[b].values?"":f[b].values,A;for(A in n)x=void 0==n[A].avg?"":n[A].avg;C(Number(b)+1,B,h+"/"+e,x,l,g,m,q,c,r);p=w+v+u+y}}}else for(a=c.poluList,b=c.time,A=a.length,d=0;d<A;d++)k=JSON.stringify(a[d]),x=void 0==a[d].value?"":a[d].value,h=void 0==a[d].family?"":a[d].family,e=void 0==a[d].name?"":a[d].name,g=void 0==a[d].max?"":a[d].max,l=void 0==a[d].min?"":a[d].min,m=void 0==a[d].unit?"":a[d].unit,n=void 0==a[d].higher?"":a[d].higher,z=void 0==a[d].lower?"":a[d].lower,q=void 0==a[d].devId?"":a[d].devId,f=void 0==a[d].time?"":a[d].time,c=void 0==a[d].factory?"":a[d].factory.name,"no"==n&&"no"==z?(r="\u6b63\u5e38",w++):"yes"==n&&"no"==z?(r="\u8d85\u4e0a\u9650",v++):"no"==n&&"yes"==z?(r="\u8d85\u4e0b\u9650",u++):(r="\u65e0\u72b6\u6001",y++),n=b-f,1==/^-?\d+(\.\d+)?$/.test(x)&&6E4>=n||(x="\u65e0\u66f4\u65b0"),C(d+1,k,h+"/"+e,x,l,g,m,q,c,r),p=w+v+u+y;sorter.init("indicatorTable",2);null!=getCookie("backCurrentPage")&&(sorter.transferToPage(Number(getCookie("backCurrentPage"))),delCookie("backCurrentPage"))}else $("#showNoData").css("display","block")}}function C(a,c,e,h,g,l,k,d,f,b){var m="detail"+a,n="\x3ctd\x3e"+h+"\x3c/td\x3e",p="\x3ctd\x3e"+b+"\x3c/td\x3e";if("\u8d85\u4e0b\u9650"==b||"\u8d85\u4e0a\u9650"==b)"\u65e0\u66f4\u65b0"!=h&&(n="\x3ctd style\x3d'color: red; font-weight: 800;'\x3e"+h+"\x3c/td\x3e"),p="\x3ctd style\x3d'color: red; font-weight: 800;'\x3e"+b+"\x3c/td\x3e";"\u65e0\u72b6\u6001"==b&&("\u65e0\u66f4\u65b0"!=h&&(n="\x3ctd style\x3d'color: #eabc14;font-weight: 800;'\x3e"+h+"\x3c/td\x3e"),p="\x3ctd style\x3d'color: #eabc14;font-weight: 800;'\x3e"+b+"\x3c/td\x3e");$("#indicatorTable tbody").append("\x3ctr id\x3d'app_"+a+"'\x3e\x3ctd style\x3d'display: none'\x3e"+c+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+a+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e"+n+"\x3ctd\x3e"+g+"-"+l+"\x3c/td\x3e\x3ctd\x3e"+k+"\x3c/td\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e"+p+"\x3ctd\x3e\x3ca href\x3d'indicatorDetail.html' class\x3d'tablelink'target\x3d'rightFrame' id\x3d'"+m+"'\x3e \u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3ca href\x3d'#'  class\x3d'delIndicator tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+m,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("indicatordata",a);setCookie("indicatorCurrentPage",$("#currentpage").text())})}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});var B=$("#statisticalDialog").dialog({autoOpen:!1,height:350,width:530,modal:!0,buttons:[{text:"\u5173\u95ed",click:function(){B.dialog("close")},"class":"sure"}]}),m=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){m.dialog("close");a=$(this).dialog("option","_button");if(null!=a)if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text());"success"!=JSON.parse(delPolusource(a.id)).errCode?alert("\u5220\u9664 "+a.family+"/"+a.name+" \u5931\u8d25\uff01"):$(this).parent().parent().remove()});else{var c=JSON.parse(a.parent().parent().children("td").eq(0).text());"success"!=JSON.parse(delPolusource(c.id)).errCode?alert("\u5220\u9664 "+c.family+"/"+c.name+" \u5931\u8d25\uff01"):a.parent().parent().remove()}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){m.dialog("close")},"class":"cancel"}]});$("#checkDetail").click(function(){B.dialog("open");p=0==p?1:p;$("#statisticalcontainer").highcharts({chart:{type:"pie"},title:{text:""},subtitle:{text:""},plotOptions:{series:{dataLabels:{enabled:!0,format:"{point.name}: {point.y:.1f}%"}}},tooltip:{headerFormat:'\x3cspan style\x3d"font-size:11px"\x3e{series.name}\x3c/span\x3e\x3cbr\x3e',pointFormat:'\x3cspan style\x3d"color:{point.color}"\x3e{point.name}\x3c/span\x3e: \x3cb\x3e{point.y:.2f}%\x3c/b\x3e of total\x3cbr/\x3e'},series:[{name:"Brands",colorByPoint:!0,data:[{name:"\u6b63\u5e38\u72b6\u6001\u6307\u6807",y:w/p*100,drilldown:"\u6b63\u5e38\u72b6\u6001\u6307\u6807"},{name:"\u65e0\u72b6\u6001\u6307\u6807",y:y/p*100,drilldown:"Chrome"},{name:"\u8d85\u4e0a\u9650\u6307\u6807",y:v/p*100,drilldown:"\u8d85\u4e0a\u9650\u6307\u6807"},{name:"\u8d85\u4e0b\u9650\u6307\u6807",y:u/p*100,drilldown:"\u8d85\u4e0b\u9650\u6307\u6807"}]}]})});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?(m.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f"),$("#tip .tipright p").html("\u5f53\u524d\u6ca1\u6709\u9009\u62e9\u4efb\u4f55\u6570\u636e\u8fdb\u884c\u5220\u9664\uff01")):(m.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f"),$("#tip .tipright p").html("\u786e\u5b9a\u5220\u9664\u6570\u636e\u4fe1\u606f\uff01"),m.dialog("option","_button","del"));m.dialog("open")});$(document).on("click",".delIndicator",function(){m.dialog("option","title","\u5220\u9664\u63d0\u793a\u4fe1\u606f");$("#tip .tipright p").html("\u786e\u5b9a\u5220\u9664\u6570\u636e\u4fe1\u606f\uff01\uff01");m.dialog("option","_button",$(this));m.dialog("open")});$("#searchType").change(function(){$("#searchType option:selected").text()});$("#searchpng").click(function(){var a=$("#searchType option:selected").text();if("\u5168\u90e8"!=a)if("\u540d\u79f0"==a){if(""==$("#searchByName").val().trim())return alert("\u5e94\u7528\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1}else"\u7c7b\u578b"==a&&$("#searchByType option:selected").val()});$("#factoryList").change(function(){q()});$("#indicatorselect").change(function(){q()});$("#startDay").change(function(){q()});$("#startDay").click(function(){laydate({istime:!1,isclear:!1,istoday:!1,format:"YYYY/MM/DD",issure:!1,start:laydate.now(-1),max:laydate.now(-1),choose:function(a){q()}});addLaydateListener()});var w=0,y=0,v=0,u=0,p=0;(function(){var a=JSON.parse(polusourcedistkey("family"));if("success"==a.errCode&&0!=a.total){var a=a.resultList,c;for(c in a){var e=a[c].family;$("\x3coption value\x3d"+e+"\x3e"+e+"\x3c/option\x3e").appendTo($("#indicatorselect"))}}})();(function(){var a={};t=JSON.parse(polusourcedistkey("factory"));if("success"==t.errCode&&0!=t.total){var c=t.resultList,e;for(e in c){var h=void 0==c[e].factory.name?"":c[e].factory.name,g=c[e].location.province,l=c[e].location.city,k=c[e].location.district;void 0==a[g]?(a[g]={},a[g][l]={},a[g][l][k]=[]):void 0==a[g][l]?(a[g][l]={},a[g][l][k]=[]):void 0==a[g][l][k]&&(a[g][l][k]=[]);a[g][l][k].push(h)}c=[];h=0;for(e in a){c.push(e);var g=0,d;for(d in a[e]){var f=[];f.push(d);var l=0,b;for(b in a[e][d]){var m=[];m.push(b);dsy.add("0_"+h+"_"+g+"_"+l,a[e][d][b]);l++}dsy.add("0_"+h+"_"+g,m);g++}dsy.add("0_"+h,f);h++}dsy.add("0",c);provinces=c;console.log(JSON.stringify(dsy));console.log(JSON.stringify(provinces))}})();var k=[];k.push("search1");k.push("search2");k.push("search3");k.push("factoryList");setup(k);0<$("#search1 option").length&&($("#search1 option").eq(1).attr("selected",!0),change(1,k));0<$("#search2 option").length&&($("#search2 option").eq(1).attr("selected",!0),change(2,k));0<$("#search3 option").length&&($("#search3 option").eq(1).attr("selected",!0),change(3,k));0<$("#factoryList option").length&&$("#factoryList option").eq(1).attr("selected",!0);q();var t;$("#search1").change(function(){change(1,k)});$("#search2").change(function(){change(2,k)});$("#search3").change(function(){change(3,k)});$("#factoryList").change(function(){change(4,k)})});