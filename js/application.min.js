$(function(){function n(a){$("#appTable tbody").empty();$("#appTable tbody").html("");a=listapp(a);a=JSON.parse(a);if("success"==a.errCode){a=a.appList;for(var b=a.length,c=0;c<b;c++){for(var f=JSON.stringify(a[c]),e=a[c].appName,g=void 0==a[c].creator?"":t(a[c].creator),h=void 0==a[c].seen?"":"operation"==a[c].seen?"\u8fd0\u8425":"\u5e94\u7528",k=void 0==a[c].funcPerm?[]:a[c].funcPerm,d="more"+(c+1),p=[],l=0;l<k.length&&3!=l;l++)p.push(k[l]);$("#appTable tbody").append("\x3ctr id\x3d'app_"+(c+1)+"'\x3e\x3ctd style\x3d'display: none'\x3e"+f+"\x3c/td\x3e\x3ctd style\x3d'width: 4%'\x3e\x3cinput name\x3d'checkbox' class\x3d'nosort' type\x3d'checkbox' id\x3d'checkbox_"+(c+1)+"'/\x3e\x3c/td\x3e\x3ctd style\x3d'width: 6%'\x3e"+(c+1)+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3ctd\x3e"+h+"\x3c/td\x3e\x3ctd\x3e"+p+"\x3ca href\x3d'../application/functionList.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+d+"'\x3e...\u66f4\u591a\x3c/a\x3e \x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#' class\x3d'delApp tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+d,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("functionlist",a)})}sorter.init("appTable",2)}}function t(a){var b={};b.userId=a;a=listuser(b);b=JSON.parse(a);if("success"==b.errCode){a="";for(var b=b.accountList,c=0;c<b.length;c++)a=void 0==b[c].userName?"":b[c].userName;return a}}function u(){var a=$("#add-app").dialog("option","title"),b=$("#appName").val().trim(),c=$("#appType option:selected").val(),f=$("#appType option:selected").text(),e=m.userId,g=m.userName;if(""==b)return $(".confirmMsg").html("\u5e94\u7528\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;if("\u6dfb\u52a0\u5e94\u7528"==a)if(a=JSON.parse(createapp(e,c,b,"")),"success"==a.errCode){var h=$("#appTable tbody tr").length+1,k="more"+h,d={};d.id=a.id;d.appName=b;d.creator=e;d.seen=c;d.funcPerm=[];$("#appTable tbody").append("\x3ctr id\x3d'app"+h+"'\x3e\x3ctd style\x3d'display: none'\x3e"+JSON.stringify(d)+"\x3c/td\x3e\x3ctd\x3e\x3cinput name\x3d'checkbox' type\x3d'checkbox' id\x3d'checkbox_"+h+"'/\x3e\x3c/td\x3e\x3ctd\x3e"+h+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3ctd\x3e"+f+"\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'../application/functionList.html' target\x3d'rightFrame' class\x3d'tablelink' id\x3d'"+k+"'\x3e...\u66f4\u591a\x3c/a\x3e \x3c/td\x3e\x3ctd\x3e\x3ca href\x3d'#' class\x3d'delApp tablelink'\x3e \u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e");$(document).on("click","#"+k,function(){var a=$(this).parent().parent().children("td").eq(0).text();setCookie("functionlist",a)})}else return alert("\u6dfb\u52a0\u5931\u8d25\uff01"),!1;else if(d=JSON.parse($("input[type\x3dcheckbox][name\x3dcheckbox]:checked").parent().parent().children("td").eq(0).text()),a={},a.appName=b,a.creator=e,"success"==JSON.parse(updateapp(d.id,c,a)).errCode)d.appName=b,d.creator=e,d.seen=c,$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){var a=$(this).parent().parent();a.children("td").eq(0).text(JSON.stringify(d));a.children("td").eq(3).text(b);a.children("td").eq(4).text(g);a.children("td").eq(5).text(f)});else return alert("\u4fee\u6539\u5931\u8d25\uff01"),!1}function v(a){a.each(function(){var a=$(this).parent().parent().children("td").eq(3).text(),c={};c.appName=a;c=JSON.parse(listapp(c));1==c.total?($("#appName").val(a),$("#appType option[value\x3d"+c.appList[0].seen+"]").attr("selected",!0),f.dialog("open"),f.dialog({title:"\u4fee\u6539\u5e94\u7528"}),q.text("\u4fee\u6539\u5e94\u7528\u4fe1\u606f")):alert("\u8bf7\u91cd\u65b0\u767b\u5f55\uff0c\u83b7\u53d6\u6570\u636e\uff01")})}$("#checkAll").click(function(){$(this).is(":checked")?$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}):$("input[name\x3d'checkbox']").each(function(){$(this).prop("checked",!1)})});var f,g,e,r,q=$(".validateTips"),m;f=$("#add-app").dialog({autoOpen:!1,height:350,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){0!=u()&&f.dialog("close")},"class":"sure"},{text:"\u53d6\u6d88",click:function(){f.dialog("close")},"class":"cancel"}]});g=$("#tip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(){g.dialog("close")},"class":"sure"}]});e=$("#deltip").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u786e\u5b9a",click:function(a){a=$(this).dialog("option","_button");e.dialog("close");if("del"==a)$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").each(function(){if("checkAll"==$(this).attr("id"))return!0;var a=JSON.parse($(this).parent().parent().children("td").eq(0).text());"success"==JSON.parse(deleteapp(a.id)).errCode?$(this).parent().parent().remove():alert("\u5220\u9664\u5e94\u7528"+a.appName+"\u5931\u8d25\uff01")});else{var b=JSON.parse(a.parent().parent().children("td").eq(0).text());"success"==JSON.parse(deleteapp(b.id)).errCode?a.parent().parent().remove():alert("\u5220\u9664\u5e94\u7528"+b.appName+"\u5931\u8d25\uff01")}},"class":"sure"},{text:"\u53d6\u6d88",click:function(){e.dialog("close")},"class":"cancel"}]});r=$("#operateDialog").dialog({autoOpen:!1,height:300,width:530,modal:!0,buttons:[{text:"\u5173\u95ed",click:function(){r.dialog("close")},"class":"sure"}]});$(".add").click(function(){$(".confirmMsg").html("");$("#appName").val("");f.dialog("open");f.dialog({title:"\u6dfb\u52a0\u5e94\u7528"});q.text("\u6dfb\u52a0\u5e94\u7528\u4fe1\u606f")});$(".update").click(function(){$(".confirmMsg").html("");var a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length;0!=a&&1==a?(a=$("input[type\x3dcheckbox][name\x3dcheckbox]:checked"),v(a)):g.dialog("open")});$(".del").click(function(){0==$("input[type\x3dcheckbox][name\x3dcheckbox]:checked").length?g.dialog("open"):(e.dialog("option","_button","del"),e.dialog("open"))});$(document).on("click",".delApp",function(){e.dialog("option","_button",$(this));e.dialog("open")});$("#searchType").change(function(){var a=$("#searchType option:selected").text();"\u5168\u90e8"==a?($("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"\u540d\u79f0"==a?($("#searchByName").css("display","inline"),$("#searchByAddress").css("display","none"),$("#searchByType").css("display","none")):"\u7c7b\u578b"==a&&($("#searchByType").css("display","inline"),$("#searchByName").css("display","none"),$("#searchByAddress").css("display","none"))});$("#searchpng").click(function(){var a={},b=$("#searchType option:selected").text();if("\u5168\u90e8"==b)a.all="";else if("\u540d\u79f0"==b){b=$("#searchByName").val().trim();if(""==b)return alert("\u5e94\u7528\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),!1;a.appName=b}else"\u7c7b\u578b"==b&&(b=$("#searchByType option:selected").val(),a.scope=b);n(a)});$("#orglist").change(function(){$("#userlist").empty();var a=$("#orglist option:selected").val().trim(),b={};b.orgId=a;a=listuser(b);a=JSON.parse(a);if("success"==a.errCode)for(a=a.accountList,b=0;b<a.length;b++)$("\x3coption value\x3d"+a[b].id+"\x3e"+a[b].userName+"\x3c/option\x3e").appendTo($("#userlist"))});(function(){var a=getCookie("userInfo");console.log("cookie\x3d"+a);m=JSON.parse(a).account})();n({all:""})});